<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶ | OnlyyğŸ¦„</title><meta name="author" content="ChrisLeyâ„ï¸"><meta name="copyright" content="ChrisLeyâ„ï¸"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å¤šåŠŸèƒ½JSè½¬è¯‘å™¨ï¼ŒBabelæœ‰è®¸è®¸å¤šå¤šçš„æ¨¡å—å¯ç”¨äºé™æ€åˆ†æã€‚è€Œåœ¨é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªç¬¦åˆé¡¹ç›®éœ€æ±‚çš„Babelæ’ä»¶ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¤§å®¶æ·±å…¥ç†è§£Babelæ’ä»¶å·¥ä½œæµç¨‹çš„åŒæ—¶ï¼Œè®©å¤§å®¶æŒæ¡å¦‚ä½•æŒ‰éœ€æ±‚ç¼–å†™è‡ªå·±çš„Babelæ’ä»¶ã€‚ ä¸€ã€åŸºç¡€çŸ¥è¯†1. Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šè§£æ(parse)ã€è½¬æ¢(transform)ã€ç”Ÿæˆ(generate) ã€‚ 2. è§£æåœ¨ è§£æ è¿™ä¸€æ­¥ï¼Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶">
<meta property="og:url" content="https://blog.onlyy.vip/articals/d92b6379/">
<meta property="og:site_name" content="OnlyyğŸ¦„">
<meta property="og:description" content="ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å¤šåŠŸèƒ½JSè½¬è¯‘å™¨ï¼ŒBabelæœ‰è®¸è®¸å¤šå¤šçš„æ¨¡å—å¯ç”¨äºé™æ€åˆ†æã€‚è€Œåœ¨é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªç¬¦åˆé¡¹ç›®éœ€æ±‚çš„Babelæ’ä»¶ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¤§å®¶æ·±å…¥ç†è§£Babelæ’ä»¶å·¥ä½œæµç¨‹çš„åŒæ—¶ï¼Œè®©å¤§å®¶æŒæ¡å¦‚ä½•æŒ‰éœ€æ±‚ç¼–å†™è‡ªå·±çš„Babelæ’ä»¶ã€‚ ä¸€ã€åŸºç¡€çŸ¥è¯†1. Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šè§£æ(parse)ã€è½¬æ¢(transform)ã€ç”Ÿæˆ(generate) ã€‚ 2. è§£æåœ¨ è§£æ è¿™ä¸€æ­¥ï¼Œ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png">
<meta property="article:published_time" content="2022-11-26T16:52:00.000Z">
<meta property="article:modified_time" content="2022-11-26T16:52:00.000Z">
<meta property="article:author" content="ChrisLeyâ„ï¸">
<meta property="article:tag" content="Babel">
<meta property="article:tag" content="å‰ç«¯å·¥ç¨‹åŒ–">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png"><link rel="shortcut icon" href="https://blog.onlyy.vip/img/favicon.ico"><link rel="canonical" href="https://blog.onlyy.vip/articals/d92b6379/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="https://blog.onlyy.vip/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"è¿™ç¯‡æ–‡ç« æ›´æ–°äº","messageNext":"å¤©ä¹‹å‰ï¼Œå†…å®¹å¯èƒ½æœ‰ç‚¹æ—§äº†å“¦ã€‚"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":150},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: ChrisLeyâ„ï¸","link":"é“¾æ¥: ","source":"æ¥æº: OnlyyğŸ¦„","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 00:52:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://assets.onlyy.vip/styles/onlyy-blog/custom.css"><meta name="baidu-site-verification" content="code-uOiahucCVX" /><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://assets.onlyy.vip/styles/onlyy-blog/footerTimer.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word" style="position: absolute;"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://assets.onlyy.vip/icons/dst/Willow.png" onerror="onerror=null;src='https://blog.onlyy.vip/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/articals/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">34</div></a><a href="/articals/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">10</div></a><a href="/articals/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon fas fa-tasks" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-shouye-01"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> é¦– é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ–‡ ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/articals/categories/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-fenlei2"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> åˆ† ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/articals/archives/"><svg class="icon fas fa-archives" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guidang"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ—¶ å…‰ æœº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/articals/tags/"><svg class="icon fas fa-tags" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-biaoqian"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ ‡ ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-yule"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ä¼‘ é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/relax/music/"><svg class="icon fa fa-camera" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-yinle"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> éŸ³ ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/movies/"><svg class="icon fas fa-video" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> å½± è§†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/games/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-youxi"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ¸¸ æˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/photos/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> çºªå¿µå†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-kongjian1"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç©º é—´</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/zone/love-story/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanai-aixin"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> LoveStory</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zone/work-life/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-shenghuo"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> Work&amp;Life</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-deng"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ¨ è</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/recommend/movies/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> å½± è§†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/recommend/books/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ä¹¦ ç±</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon fas fa-envelope" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-xiangsufeng_xinfeng"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç•™ è¨€ æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanyuwomen"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç¤¾ äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="icon fas fa-link" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-lianjie"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> Friends</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanyu"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> About</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">OnlyyğŸ¦„</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon fas fa-tasks" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-shouye-01"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> é¦– é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ–‡ ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/articals/categories/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-fenlei2"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> åˆ† ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/articals/archives/"><svg class="icon fas fa-archives" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guidang"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ—¶ å…‰ æœº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/articals/tags/"><svg class="icon fas fa-tags" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-biaoqian"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ ‡ ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-yule"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ä¼‘ é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/relax/music/"><svg class="icon fa fa-camera" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-yinle"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> éŸ³ ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/movies/"><svg class="icon fas fa-video" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> å½± è§†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/games/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-youxi"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ¸¸ æˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/relax/photos/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> çºªå¿µå†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-kongjian1"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç©º é—´</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/zone/love-story/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanai-aixin"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> LoveStory</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zone/work-life/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-shenghuo"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> Work&amp;Life</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-deng"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> æ¨ è</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/recommend/movies/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-dianying"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> å½± è§†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/recommend/books/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-tubiaozhizuomoban-"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ä¹¦ ç±</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon fas fa-envelope" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-xiangsufeng_xinfeng"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç•™ è¨€ æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanyuwomen"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> ç¤¾ äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="icon fas fa-link" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-lianjie"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> Friends</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true" style="font-size: 1.2em;"><use xlink:href="#icon-guanyu"></use></svg><span style="font-size: 1em; font-weight: bold; text-shadow: #c909f1 0 0 3px;"> About</span></a></li></ul></div></div></div><div id="nav-right"><div id="search-button" style="margin-right: 1em;"><a class="site-page social-icon search"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg></a></div><div id="darkmode-button" style="margin-right: 1em;" title="åˆ‡æ¢å¤œé—´æ¨¡å¼"><a class="darkmode switch"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ClearNight-qing-yewan"></use></svg></a></div><div id="toggle-menu"><a class="site-page"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-caidanpeizhi"></use></svg></a></div></div></nav><div id="post-info"><h1 class="post-title">å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-11-26T16:52:00.000Z" title="å‘è¡¨äº 2022-11-27 00:52:00">2022-11-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-11-26T16:52:00.000Z" title="æ›´æ–°äº 2022-11-27 00:52:00">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/articals/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>32åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title="å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/articals/d92b6379/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å¤šåŠŸèƒ½<code>JS</code>è½¬è¯‘å™¨ï¼Œ<code>Babel</code>æœ‰è®¸è®¸å¤šå¤šçš„æ¨¡å—å¯ç”¨äºé™æ€åˆ†æã€‚è€Œåœ¨é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»ºä¸€ä¸ªç¬¦åˆé¡¹ç›®éœ€æ±‚çš„<code>Babel</code>æ’ä»¶ã€‚æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¤§å®¶æ·±å…¥ç†è§£<code>Babel</code>æ’ä»¶å·¥ä½œæµç¨‹çš„åŒæ—¶ï¼Œè®©å¤§å®¶æŒæ¡å¦‚ä½•æŒ‰éœ€æ±‚ç¼–å†™è‡ªå·±çš„<code>Babel</code>æ’ä»¶ã€‚</p>
<h2 id="ä¸€ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€åŸºç¡€çŸ¥è¯†</h2><h3 id="1-Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š"><a href="#1-Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š" class="headerlink" title="1. Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š"></a>1. <code>Babel</code>å¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</h3><p><strong>è§£æ(<code>parse</code>)</strong>ã€<strong>è½¬æ¢(<code>transform</code>)</strong>ã€<strong>ç”Ÿæˆ(<code>generate</code>)</strong> ã€‚</p>
<h3 id="2-è§£æ"><a href="#2-è§£æ" class="headerlink" title="2. è§£æ"></a>2. è§£æ</h3><p>åœ¨ <strong>è§£æ</strong> è¿™ä¸€æ­¥ï¼Œ<code>Babel</code>æ¥æ”¶ä»£ç ï¼Œå¤„ç†åç”Ÿæˆ <code>AST</code> ã€‚è¯¥æ­¥éª¤åˆ†ä¸º <strong>è¯æ³•åˆ†æ(<code>Lexical Analysis</code>)</strong> å’Œ <strong>è¯­æ³•åˆ†æ(<code>Syntactic Analysis</code>)</strong> ä¸¤ä¸ªé˜¶æ®µã€‚</p>
<h4 id="2-1-è¯æ³•åˆ†æ"><a href="#2-1-è¯æ³•åˆ†æ" class="headerlink" title="2.1 è¯æ³•åˆ†æ"></a>2.1 è¯æ³•åˆ†æ</h4><p><code>Babel</code>æ¥æ”¶çš„æºä»£ç ä¸ºä»£ç å­—ç¬¦ä¸²ï¼Œè¯æ³•åˆ†æä¼šæŠŠå­—ç¬¦ä¸²ä»£ç è½¬åŒ–ä¸º <strong>ä»¤ç‰Œ(<code>tokens</code>)</strong> æµï¼Œä»¤ç‰Œæ˜¯å¯¹ä»£ç è¯æ³•çš„æè¿°ã€‚å¯ä»¥çœ‹ä½œä¸€ä¸ªæ‰å¹³çš„è¯­æ³•ç‰‡æ®µæ•°ç»„ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹è¯­æ³•ç‰‡æ®µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n * n;</span><br></pre></td></tr></table></figure>
<p>å°†è¢«è½¬åŒ–ä¸ºå¦‚ä¸‹ä»¤ç‰Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å…·æœ‰<code>type</code>å’Œ<code>value</code>å±æ€§ä»¥å¤–ï¼Œä»¤ç‰Œè¿˜å’Œ<code>AST</code>ä¸€æ ·å…·æœ‰<code>start</code>, <code>end</code>, <code>loc</code>å±æ€§ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;n&quot;</span>, <span class="attr">start</span>: <span class="number">0</span>, <span class="attr">end</span>: <span class="number">1</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;*&quot;</span>, <span class="attr">start</span>: <span class="number">2</span>, <span class="attr">end</span>: <span class="number">3</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;n&quot;</span>, <span class="attr">start</span>: <span class="number">4</span>, <span class="attr">end</span>: <span class="number">5</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œæ¯ä¸ª<code>type</code>éƒ½æœ‰ä¸€ç»„å±æ€§æ¥æè¿°è¯¥ä»¤ç‰Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="attr">keyword</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">beforeExpr</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">startsExpr</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">rightAssociative</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isLoop</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">isAssign</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">prefix</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">postfix</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">binop</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">updateContext</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-è¯­æ³•åˆ†æ"><a href="#2-2-è¯­æ³•åˆ†æ" class="headerlink" title="2.2 è¯­æ³•åˆ†æ"></a>2.2 è¯­æ³•åˆ†æ</h4><p>è¯æ³•åˆ†æå°†å­—ç¬¦ä¸²ä»£ç è½¬åŒ–ä¸º<code>tokens</code>ï¼Œè¯­æ³•åˆ†æåˆ™æ˜¯æ ¹æ®<code>tokens</code>ç”Ÿæˆ<code>AST</code>çš„è¡¨è¿°ç»“æ„ï¼Œè¿™æ ·æ›´æ˜“äºè¿›è¡Œåç»­æ“ä½œã€‚</p>
<h3 id="3-è½¬æ¢"><a href="#3-è½¬æ¢" class="headerlink" title="3. è½¬æ¢"></a>3. è½¬æ¢</h3><p><strong>è½¬æ¢</strong> æ­¥éª¤æ¥æ”¶<code>AST</code>å¹¶å¯¹å…¶è¿›è¡Œéå†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸»è¦å¯¹èŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹ï¼Œæ˜¯ç¼–è¯‘å™¨æœ€ä¸ºå¤æ‚çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æ’ä»¶å°†è¦ä»‹å…¥å·¥ä½œçš„éƒ¨åˆ†ã€‚æœ¬æ–‡çš„ä¸»è¦å†…å®¹ä¹Ÿå°†å›´ç»•è¿™ä¸ªéƒ¨åˆ†å±•å¼€ã€‚</p>
<h3 id="4-ç”Ÿæˆ"><a href="#4-ç”Ÿæˆ" class="headerlink" title="4. ç”Ÿæˆ"></a>4. ç”Ÿæˆ</h3><p><strong>ç”Ÿæˆ</strong> çš„æ­¥éª¤ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯å¯¹ ç»è¿‡ä¸€ç³»åˆ—è½¬åŒ–å¾—åˆ°çš„æœ€ç»ˆ <code>AST</code> è¿›è¡Œ æ·±åº¦ä¼˜å…ˆéå† æ¥ç”Ÿæˆå­—ç¬¦ä¸²å½¢å¼çš„ä»£ç ï¼Œå¹¶åˆ›å»º <strong>æºç æ˜ å°„(<code>source maps</code>)</strong> ã€‚</p>
<h3 id="5-æŠ½è±¡è¯­æ³•æ ‘-AST"><a href="#5-æŠ½è±¡è¯­æ³•æ ‘-AST" class="headerlink" title="5. æŠ½è±¡è¯­æ³•æ ‘ AST"></a>5. æŠ½è±¡è¯­æ³•æ ‘ <code>AST</code></h3><p><code>Babel</code>çš„å¤„ç†è¿‡ç¨‹æ¯ä¸€æ­¥éƒ½æ¶‰åŠåˆ›å»ºæˆ–æ“ä½œ<code>AST</code>ï¼Œä½¿ç”¨çš„æ˜¯åŸºäº<code>ESTree</code>å¹¶ä¿®æ”¹è¿‡çš„<code>AST</code>ã€‚ä¾‹å¦‚å¯¹äºä»¥ä¸‹ç¨‹åºç‰‡æ®µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼šè¢«å¤„ç†ä¸ºå¦‚ä¸‹<code>AST</code>ï¼š</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- FunctionDeclaration:</span><br><span class="line">  - id:</span><br><span class="line">    - Identifier:</span><br><span class="line">      - name: square</span><br><span class="line">  - params <span class="section">[1]</span></span><br><span class="line">    - Identifier</span><br><span class="line">      - name: n</span><br><span class="line">  - body:</span><br><span class="line">    - BlockStatement</span><br><span class="line">      - body <span class="section">[1]</span></span><br><span class="line">        - ReturnStatement</span><br><span class="line">          - argument</span><br><span class="line">            - BinaryExpression</span><br><span class="line">              - operator: *</span><br><span class="line">              - left</span><br><span class="line">                - Identifier</span><br><span class="line">                  - name: n</span><br><span class="line">              - right</span><br><span class="line">                - Identifier</span><br><span class="line">                  - name: n</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä»¥<code>JS</code>å¯¹è±¡æ¥è¡¨ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;FunctionDeclaration&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;square&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">params</span>: [&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;BlockStatement&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: [&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;ReturnStatement&quot;</span>,</span><br><span class="line">      <span class="attr">argument</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;BinaryExpression&quot;</span>,</span><br><span class="line">        <span class="attr">operator</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        <span class="attr">left</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">right</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒçš„å±‚çº§å„è‡ªå…·æœ‰ä¸€è‡´çš„ç»“æ„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;FunctionDeclaration&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">params</span>: [...],</span><br><span class="line">  <span class="attr">body</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;BinaryExpression&quot;</span>,</span><br><span class="line">  <span class="attr">operator</span>: ...,</span><br><span class="line">  <span class="attr">left</span>: &#123;...&#125;,</span><br><span class="line">  <span class="attr">right</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„æ¯ä¸€å±‚ç»“æ„å«åš <strong>èŠ‚ç‚¹(<code>Node</code>)</strong> ã€‚ä¸€ä¸ª<code>AST</code>å¯ä»¥ç”±ä¸€ä¸ªæˆ–è®¸å¤šä¸ªèŠ‚ç‚¹æ„æˆã€‚è¿™äº›èŠ‚ç‚¹ç»„åˆåœ¨ä¸€èµ·å¯ç”¨ä»¥æè¿°ç”¨äºé™æ€åˆ†æçš„ç¨‹åºè¯­æ³•ã€‚è€Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¦‚ä¸‹æ¥å£ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">	<span class="attr">type</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>string</code>å½¢å¼çš„<code>type</code>å­—æ®µè¡¨ç¤ºèŠ‚ç‚¹çš„ç±»å‹ï¼Œå¦‚<code>&quot;FunctionDeclaration&quot;</code>, <code>&quot;Identifier&quot;</code>, <code>&quot;BinaryExpression&quot;</code> ç­‰ã€‚ä¸”æ¯ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œåˆå®šä¹‰äº†ä¸€äº›é™„åŠ å±æ€§æ¥è¿›ä¸€æ­¥æè¿°è¯¥èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œ<code>Babel</code>è¿˜ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆäº†é¢å¤–å±æ€§(<code>start</code>, <code>end</code>, <code>loc</code> ç­‰)ï¼Œç”¨äºæè¿°è¯¥èŠ‚ç‚¹åœ¨åŸå§‹ä»£ç ä¸­çš„ä½ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è¿™äº›å±æ€§ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: ...,</span><br><span class="line">  <span class="attr">start</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">end</span>: <span class="number">38</span>,</span><br><span class="line">  <span class="attr">loc</span>: &#123;</span><br><span class="line">    <span class="attr">start</span>: &#123;</span><br><span class="line">      <span class="attr">line</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">column</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">end</span>: &#123;</span><br><span class="line">      <span class="attr">line</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">column</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-éå†"><a href="#6-éå†" class="headerlink" title="6. éå†"></a>6. éå†</h3><p>è¦æƒ³è½¬æ¢<code>AST</code>ï¼Œåˆ™éœ€è¦å¯¹<code>AST</code>è¿›è¡Œé€’å½’éå†ã€‚å‡å¦‚æœ‰ä¸€ä¸ª<code>FunctionDeclaration</code>ç±»å‹ï¼Œå®ƒæœ‰å¦‚ä¸‹å‡ ä¸ªå±æ€§ï¼š<code>id</code>, <code>params</code>, <code>body</code>ï¼Œä¸”æ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€äº›å†…åµŒèŠ‚ç‚¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;FunctionDeclaration&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;square&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">params</span>: [&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;BlockStatement&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: [&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;ReturnStatement&quot;</span>,</span><br><span class="line">      <span class="attr">argument</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;BinaryExpression&quot;</span>,</span><br><span class="line">        <span class="attr">operator</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        <span class="attr">left</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">right</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;n&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§å¦‚ä¸‹é¡ºåºéå†ä»¥ä¸Š<code>AST</code>ï¼š</p>
<ul>
<li>æˆ‘ä»¬ä»<code>FunctionDeclaration</code>å¼€å§‹ä¾æ¬¡è®¿é—®æ¯ä¸€ä¸ªå±æ€§åŠå…¶å­èŠ‚ç‚¹ï¼›</li>
<li>éšåæ¥å¸¦<code>id</code>ï¼Œæ˜¯ä¸ª<code>Identifier</code>ï¼Œä¸”å®ƒæ²¡æœ‰ä»»ä½•å­èŠ‚ç‚¹å±æ€§ï¼›</li>
<li>äºæ˜¯ç»§ç»­è®¿é—®ä¸‹ä¸€ä¸ªå±æ€§<code>params</code>ï¼Œè€Œ<code>params</code>æ˜¯ä¸€ä¸ªæ•°ç»„èŠ‚ç‚¹ï¼Œå› æ­¤è¦éå†è®¿é—®å…¶ä¸­çš„æ¯ä¸€ä¸ªï¼Œå®ƒä»¬éƒ½æ˜¯<code>Identifier</code>ç±»å‹çš„å•ä¸€èŠ‚ç‚¹ï¼›</li>
<li>ç»§ç»­ä¸‹å»ï¼Œå˜æ¥åˆ°äº†<code>body</code>ï¼Œæ˜¯ä¸ª<code>BlockStatement</code>ï¼Œä¸”å†…éƒ¨è¿˜æœ‰ä¸ª<code>body</code>èŠ‚ç‚¹ï¼Œå†…éƒ¨çš„<code>body</code>èŠ‚ç‚¹æ˜¯ä¸ªæ•°ç»„èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬éå†è®¿é—®å…¶ä¸­çš„æ¯ä¸€ä¸ªï¼›</li>
<li>è€Œåœ¨è¿™é‡Œï¼Œå†…éƒ¨çš„<code>body</code>èŠ‚ç‚¹å”¯ä¸€çš„å­èŠ‚ç‚¹æ˜¯ä¸ª<code>ReturnStatement</code>ï¼Œå®ƒæœ‰ä¸ª<code>argument</code>ï¼Œè®¿é—®è¿™ä¸ª<code>argument</code>ä¾¿æ‰¾åˆ°äº†<code>BinaryExpression</code>ã€‚</li>
<li><code>BinaryExpression</code>æœ‰ä¸€ä¸ª<code>operator</code>ï¼Œä¸€ä¸ª<code>left</code>ï¼Œä¸€ä¸ª<code>right</code>ã€‚</li>
<li><code>operator</code>åªæ˜¯ä¸€ä¸ªå€¼è€Œä¸æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦è®¿é—®<code>left</code>å’Œ<code>right</code>ã€‚</li>
</ul>
<h3 id="7-Visitors-è®¿é—®è€…"><a href="#7-Visitors-è®¿é—®è€…" class="headerlink" title="7. Visitors (è®¿é—®è€…)"></a>7. <code>Visitors</code> (è®¿é—®è€…)</h3><p>è¯´åˆ° â€œè¿›å…¥â€ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®é™…ä¸Šæ˜¯è¯´æˆ‘ä»¬åœ¨ <strong>è®¿é—®</strong> ä»–ä»¬ã€‚è¿™ä¸ªæœ¯è¯­å‡ºè‡ª <strong>è®¿é—®è€…æ¨¡å¼(<code>visitor</code>) </strong>çš„æ¦‚å¿µã€‚è®¿é—®è€…æ˜¯ä¸€ä¸ªç”¨äº<code>AST</code>éå†çš„è·¨è¯­è¨€çš„æ¨¡å¼ã€‚ç®€å•çš„è¯´ï¼Œä»–ä»¬å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®šä¹‰äº†ç”¨äºåœ¨ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ä¸­è·å–å…·ä½“èŠ‚ç‚¹çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¿é—®è€…</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>() &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Called!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ ä¹Ÿå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ï¼Œå¹¶åœ¨ç¨åç»™å®ƒæ·»åŠ æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">let</span> visitor = &#123;&#125;;</span><br><span class="line">visitor.<span class="property">MemberExpression</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">visitor.<span class="property">FunctionDeclaration</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¾¿æ˜¯ä¸€ä¸ªæä¸ºç®€å•çš„è®¿é—®è€…ï¼Œæ¯å½“åœ¨<code>AST</code>ä¸­é‡åˆ°<code>Identifier</code>æ—¶ï¼Œå°±ä¼šè°ƒç”¨<code>Identifier</code>æ–¹æ³•ã€‚å¦‚æœå°†è¿™ä¸ªè®¿é—®è€…åº”ç”¨åˆ°å¦‚ä¸‹ä»£ç ä¸­ï¼Œ<code>Identifier</code>æ–¹æ³•ä¾¿ä¼šæ‰§è¡Œ<code>4</code>æ¬¡(<code>square</code>å’Œ<code>3</code>ä¸ª<code>n</code>å„ä¸€æ¬¡)ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">traverse</span>(<span class="title class_">MyVisitor</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called!</span></span><br><span class="line"><span class="comment"> * Called!</span></span><br><span class="line"><span class="comment"> * Called!</span></span><br><span class="line"><span class="comment"> * Called!</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›è°ƒç”¨éƒ½å‘ç”Ÿåœ¨ <strong>è¿›å…¥</strong> èŠ‚ç‚¹æ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ <strong>é€€å‡º</strong> èŠ‚ç‚¹æ—¶è°ƒç”¨è®¿é—®è€…æ–¹æ³•ã€‚ä¾‹å¦‚å¯¹äºå¦‚ä¸‹æ ‘çŠ¶ç»“æ„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">FunctionDeclaration</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Identifier</span> <span class="string">(id)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Identifier</span> <span class="string">(params[0])</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">BlockStatement</span> <span class="string">(body)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReturnStatement</span> <span class="string">(body)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">BinaryExpression</span> <span class="string">(argument)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Identifier</span> <span class="string">(left)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Identifier</span> <span class="string">(right)</span></span><br></pre></td></tr></table></figure>
<p>å½“å‘ä¸‹éå†æ¯ä¸€ä¸ªåˆ†æ”¯æ—¶ï¼Œä¼šèµ°åˆ°è¯¥åˆ†æ”¯çš„å°½å¤´ï¼Œæ­¤æ—¶ï¼Œä¾¿è¦å‘ä¸Šéå†å›å»ï¼Œä»¥ä¾¿è®¿é—®ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å‘ä¸‹éå†æ—¶æˆ‘ä»¬ <strong>è¿›å…¥(enter)</strong> æ¯ä¸ªèŠ‚ç‚¹ï¼Œè€Œå‘ä¸Šéå†æ—¶æˆ‘ä»¬ <strong>é€€å‡º(exit)</strong> æ¯ä¸ªèŠ‚ç‚¹ã€‚ä»¥éå†ä¸Šé¢çš„æ ‘ä¸ºä¾‹ï¼š</p>
<ul>
<li><p>è¿›å…¥<code>FunctionDeclaration</code></p>
<ul>
<li>è¿›å…¥ <code>Identifier (id)</code></li>
<li>èµ°åˆ°å°½å¤´</li>
<li><p>é€€å‡º <code>Identifier (id)</code></p>
</li>
<li><p>è¿›å…¥ <code>Identifier (params[0])</code></p>
</li>
<li><p>èµ°åˆ°å°½å¤´</p>
</li>
<li><p>é€€å‡º <code>Identifier (params[0])</code></p>
</li>
<li><p>è¿›å…¥ <code>BlockStatement (body)</code></p>
<ul>
<li><p>è¿›å…¥ <code>ReturnStatement (body)</code></p>
<ul>
<li><p>è¿›å…¥ <code>BinaryExpression (argument)</code></p>
<ul>
<li>è¿›å…¥ <code>Identifier (left)</code></li>
<li>èµ°åˆ°å°½å¤´</li>
<li>é€€å‡º <code>Identifier (left)</code></li>
<li>è¿›å…¥ <code>Identifier (right)</code></li>
<li>èµ°åˆ°å°½å¤´</li>
<li>é€€å‡º <code>Identifier (right)</code></li>
</ul>
</li>
<li><p>é€€å‡º <code>BinaryExpression (argument)</code></p>
</li>
</ul>
</li>
<li><p>é€€å‡º <code>ReturnStatement (body)</code></p>
</li>
</ul>
</li>
<li><p>é€€å‡º <code>BlockStatement (body)</code></p>
</li>
</ul>
</li>
<li><p>é€€å‡º <code>FunctionDeclarati</code></p>
</li>
</ul>
<p>å› æ­¤ï¼Œå½“åˆ›å»ºè®¿é—®è€…æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæœ‰ä¸¤æ¬¡æœºä¼šæ¥è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ <strong>è¿›å…¥(<code>enter</code>)</strong> å’Œ <strong>é€€å‡º(<code>exit</code>)</strong>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>: &#123;</span><br><span class="line">    <span class="title function_">enter</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Entered!&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">exit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Exited!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è€Œæˆ‘ä»¬ä¹‹å‰å†™çš„<code>Identifier() &#123; ... &#125;</code> åˆ™æ˜¯ <code>Identifier: &#123; enter() &#123; ... &#125; &#125;</code> çš„ç®€å†™å½¢å¼ï¼Œè¡¨ç¤ºåœ¨è¿›å…¥æ—¶è®¿é—®èŠ‚ç‚¹ã€‚</p>
<p>åœ¨æœ‰éœ€è¦çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>|</code>æ¥æŠŠæ–¹æ³•ååˆ†éš”ä¸º<code>Idenfifier|MemberExpression</code>å½¢å¼çš„å­—ç¬¦ä¸²ï¼ŒæŠŠåŒä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°å¤šä¸ªè®¿é—®èŠ‚ç‚¹ã€‚æ³¨æ„æ­¤æ—¶éœ€è¦ç»™æ–¹æ³•ååŠ ä¸Šå¼•å·ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="string">&quot;ExportNamedDeclaration|Flow&quot;</span>(path) &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åä½œä¸ºæ–¹æ³•åï¼Œä¾‹å¦‚<code>Function</code>æ˜¯<code>FunctionDeclaration</code>ã€<code>FunctionExpression</code>ã€<code>ArrowFunctionExpression</code>ã€<code>ObjectMethod</code>å’Œ<code>ClassMethod</code>çš„åˆ«åã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">Function</span>(path) &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="8-Paths-è·¯å¾„"><a href="#8-Paths-è·¯å¾„" class="headerlink" title="8. Paths è·¯å¾„"></a>8. <code>Paths</code> è·¯å¾„</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œ<code>AST</code>ä¸­æœ‰è®¸å¤šçš„èŠ‚ç‚¹ã€‚é‚£ä¹ˆå¦‚ä½•å»æŠŠèŠ‚ç‚¹è¿›è¡Œç›¸äº’å…³è”å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¨å¤§çš„å¯æ“ä½œå¯¹è±¡æ¥æè¿°èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚è€Œä½¿ç”¨ <strong>è·¯å¾„(<code>Paths</code>)</strong> ä¾¿èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><code>Path</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥æè¿°ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹èŠ‚ç‚¹å’Œå…¶å­èŠ‚ç‚¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;FunctionDeclaration&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;square&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†å­èŠ‚ç‚¹è¡¨ç¤ºä¸ºä¸€ä¸ªè·¯å¾„(<code>Path</code>)ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;parent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FunctionDeclaration&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ....</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;node&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;square&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œå®ƒè¿˜ä¼šåŒ…å«è¯¥è·¯å¾„çš„å…¶å®ƒå…ƒæ•°æ®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;parent&quot;</span>: &#123;...&#125;,</span><br><span class="line">  <span class="string">&quot;node&quot;</span>: &#123;...&#125;,</span><br><span class="line">  <span class="string">&quot;hub&quot;</span>: &#123;...&#125;,</span><br><span class="line">  <span class="string">&quot;contexts&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;shouldSkip&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;shouldStop&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;removed&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;state&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;opts&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;skipKeys&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;parentPath&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;context&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;container&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;listKey&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;inList&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;parentKey&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;scope&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;typeAnnotation&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼Œ<strong>è·¯å¾„å¯¹è±¡ä¸Šè¿˜åŒ…å«äº†å¢åˆ ã€æ›´æ–°ã€ç§»åŠ¨ç­‰è®¸å¤šå…¶å®ƒæ–¹æ³•</strong>ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè·¯å¾„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åœ¨<code>AST</code>ä¸­çš„ä½ç½®ä»¥åŠå’ŒèŠ‚ç‚¹ç›¸å…³çš„ä¿¡æ¯çš„<strong>å“åº”å¼(<code>Reactive</code>)</strong>è¡¨ç¤ºã€‚æ¯å½“è°ƒç”¨äº†ä¿®æ”¹æ ‘çš„æ–¹æ³•ï¼Œç›¸å…³è·¯å¾„ä¿¡æ¯ä¹Ÿä¼šéšä¹‹æ›´æ–°ï¼Œè€Œè¿™äº›éƒ½ç”±<code>Babel</code>ç®¡ç†ï¼Œä½¿å¾—æˆ‘ä»¬æ“ä½œèŠ‚ç‚¹æ›´åŠ ç®€å•ï¼Œå°½å¯èƒ½åœ°åšåˆ°æ— çŠ¶æ€ã€‚</p>
<h4 id="Path-in-Visitors-å­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„"><a href="#Path-in-Visitors-å­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„" class="headerlink" title="Path in Visitors å­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„"></a><code>Path in Visitors</code> å­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„</h4><p>å½“æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>Identifier()</code>æ–¹æ³•çš„<code>Visitor</code>æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬è®¿é—®çš„æ˜¯è·¯å¾„ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ“ä½œçš„å°±æ˜¯èŠ‚ç‚¹çš„å“åº”å¼è¡¨ç¤ºï¼ˆå³è·¯å¾„ï¼‰ï¼Œè€ŒéèŠ‚ç‚¹æœ¬èº«ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Visiting: &quot;</span> + path.<span class="property">node</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a + b + c;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">traverse</span>(<span class="title class_">MyVisitor</span>);</span><br><span class="line"><span class="comment">// Visiting: a</span></span><br><span class="line"><span class="comment">// Visiting: b</span></span><br><span class="line"><span class="comment">// Visiting: c</span></span><br></pre></td></tr></table></figure>
<h3 id="9-State-çŠ¶æ€"><a href="#9-State-çŠ¶æ€" class="headerlink" title="9. State çŠ¶æ€"></a>9. <code>State</code> çŠ¶æ€</h3><p>å¯¹äº<code>AST</code>è€Œè¨€ï¼ŒçŠ¶æ€ç®¡ç†æ˜¯æå…¶éº»çƒ¦çš„ï¼Œå¾€å¾€ä¼šæœ‰ä¸€äº›æœªè€ƒè™‘åˆ°çš„è¯­æ³•æ¥æ¨ç¿»æˆ‘ä»¬ä¹‹å‰å¯¹çŠ¶æ€çš„å‡è®¾ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªæŠŠ<code>n</code>é‡å‘½åä¸º<code>x</code>çš„å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> paramName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">const</span> param = path.<span class="property">node</span>.<span class="property">params</span>[<span class="number">0</span>];</span><br><span class="line">    paramName = param.<span class="property">name</span>;</span><br><span class="line">    param.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">name</span> === paramName) &#123;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šè®¿é—®è€…å¯ä»¥å°†å‡½æ•°å‚æ•°ä¸­çš„<code>n</code>é‡å‘½åä¸º<code>x</code>ï¼Œä¸”ä¹‹åæ‰€æœ‰åä¸º<code>n</code>çš„<code>Identifier</code>ï¼Œéƒ½å°†é‡å‘½åä¸º<code>x</code>ã€‚ç¡®å®å¯ä»¥è®©<code>square</code>å‡½æ•°ä¸­çš„<code>n</code>é‡å‘½åä¸º<code>x</code>ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°é¢„æ–™ä¹‹å¤–çš„æƒ…å†µï¼Œå› ä¸ºå…¨å±€çš„åå­—ä¸º<code>n</code>çš„<code>Identifier</code>éƒ½è¢«ä¼šæ±¡æŸ“ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥ä¸‹çš„nä¹Ÿä¼šè¢«é‡å‘½åä¸ºx</span></span><br><span class="line">n;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œç»™è®¿é—®è€…æ·»åŠ æ–¹æ³•æ—¶ï¼Œæœ€å¥½ä½¿ç”¨é€’å½’ï¼Œä»¥ä¾¿æ¶ˆé™¤å¯¹å…¨å±€çŠ¶æ€çš„å½±å“ã€‚å¦‚ä¸‹ï¼Œå¯å°†ä¸€ä¸ª<code>Visitor</code>æ”¾è¿›å¦ä¸€ä¸ª<code>Visitor</code>ä¸­ï¼Œè¿™æ—¶å€™çš„<code>Identifier()</code>åªåœ¨<code>MyVisitor</code>çš„<code>FunctionDeclaration</code>ä¸­ç”Ÿæ•ˆï¼Œä¸ä¼šé€ æˆå…¨å±€æ±¡æŸ“ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> updateParamNameVisitor = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">name</span> === <span class="variable language_">this</span>.<span class="property">paramName</span>) &#123;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">const</span> param = path.<span class="property">node</span>.<span class="property">params</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> paramName = param.<span class="property">name</span>;</span><br><span class="line">    param.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line"></span><br><span class="line">    path.<span class="title function_">traverse</span>(updateParamNameVisitor, &#123; paramName &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">traverse</span>(<span class="title class_">MyVisitor</span>);</span><br></pre></td></tr></table></figure>
<h3 id="10-Scopes-ä½œç”¨åŸŸ"><a href="#10-Scopes-ä½œç”¨åŸŸ" class="headerlink" title="10. Scopes ä½œç”¨åŸŸ"></a>10. <code>Scopes</code> ä½œç”¨åŸŸ</h3><p><code>JS</code>æ”¯æŒè¯æ³•ä½œç”¨åŸŸï¼Œåœ¨æ ‘çŠ¶åµŒå¥—ç»“æ„ä¸­ä»£ç å—åˆ›å»ºå‡ºæ–°çš„ä½œç”¨åŸŸã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global scope å…¨å±€ä½œç”¨åŸŸ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scopeOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å±€éƒ¨ä½œç”¨åŸŸ1</span></span><br><span class="line">  <span class="comment">// scope 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">scopeTwo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å±€éƒ¨ä½œç”¨åŸŸ2</span></span><br><span class="line">    <span class="comment">// scope 2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>JS</code>ä¸­ï¼Œå½“ä¸€ä¸ªå¼•ç”¨è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ— è®ºæ˜¯é€šè¿‡å˜é‡(<code>variable</code>)ï¼Œå‡½æ•°(<code>function</code>)ï¼Œç±»å‹(<code>class</code>)ï¼Œå‚æ•°(<code>params</code>)ï¼Œæ¨¡å—å¯¼å…¥(<code>import</code>) è¿˜æ˜¯ æ ‡ç­¾(<code>label</code>)ï¼Œå®ƒéƒ½å±äºå½“å‰ä½œç”¨åŸŸã€‚æ›´æ·±çš„å†…éƒ¨ä½œç”¨åŸŸå¯ä»¥ä½¿ç”¨å…¶å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå’Œå¤–éƒ¨ä½œç”¨åŸŸåŒåçš„å¼•ç”¨ã€‚å½“ç¼–å†™è½¬æ¢æ—¶ï¼Œå°¤å…¶éœ€è¦æ³¨æ„ä½œç”¨åŸŸï¼Œç¡®ä¿åœ¨æ”¹å˜ä»£ç å„ä¸ªéƒ¨åˆ†æ—¶ä¸ä¼šç ´åå·²ç»å­˜åœ¨çš„ä»£ç ã€‚</p>
<ul>
<li>å½“æ·»åŠ ä¸€ä¸ªæ–°çš„å¼•ç”¨æ—¶ï¼Œç¡®ä¿ä¸ä¼šå’Œå·²æœ‰çš„å¼•ç”¨å‘ç”Ÿå†²çªï¼›</li>
<li>æŸ¥æ‰¾ä½¿ç”¨æŸä¸ªå¼•ç”¨çš„æ‰€æœ‰å˜é‡æ—¶ï¼Œç¡®ä¿æ˜¯åœ¨ç»™å®šçš„ä½œç”¨åŸŸä¸­è¿›è¡Œï¼›</li>
</ul>
<p>ä½œç”¨åŸŸå¯ä»¥è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: path,</span><br><span class="line">  <span class="attr">block</span>: path.<span class="property">node</span>,</span><br><span class="line">  <span class="attr">parentBlock</span>: path.<span class="property">parent</span>,</span><br><span class="line">  <span class="attr">parent</span>: parentScope,</span><br><span class="line">  <span class="attr">bindings</span>: [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸæ—¶ï¼Œéœ€è¦ç»™å‡ºå®ƒçš„è·¯å¾„å’Œçˆ¶ä½œç”¨åŸŸã€‚ä¹‹ååœ¨éå†è¿‡ç¨‹ä¸­å®ƒä¼šæ”¶é›†æ‰€æœ‰çš„å¼•ç”¨(â€œ<code>Bindings</code>â€)ï¼Œä¸€æ—¦æ”¶é›†å®Œæ¯•ï¼Œå°±å¯ä»¥åœ¨ä½œç”¨åŸŸä¸Šä½¿ç”¨å„ç§æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šåœ¨åç»­ä»‹ç»ã€‚</p>
<h4 id="Bindings-ç»‘å®š"><a href="#Bindings-ç»‘å®š" class="headerlink" title="Bindings ç»‘å®š"></a><code>Bindings</code> ç»‘å®š</h4><p>æ¯ä¸ª å¼•ç”¨ éƒ½å±äºç‰¹å®šçš„ ä½œç”¨åŸŸï¼Œå¼•ç”¨ å’Œ ä½œç”¨åŸŸ ä¹‹é—´çš„è¿™ç§å…³ç³»è¢«ç§°ä¸º <strong>ç»‘å®š(binding)</strong>ã€‚å•ä¸ªç»‘å®šçœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">identifier</span>: node,</span><br><span class="line">  <span class="attr">scope</span>: scope,</span><br><span class="line">  <span class="attr">path</span>: path,</span><br><span class="line">  <span class="attr">kind</span>: <span class="string">&#x27;var&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">referenced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">references</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">referencePaths</span>: [path, path, path],</span><br><span class="line"></span><br><span class="line">  <span class="attr">constant</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">constantViolations</span>: [path]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥æŸ¥æ‰¾åˆ°ä¸€ä¸ªç»‘å®šçš„æ‰€æœ‰å¼•ç”¨ï¼Œä»¥åŠè¯¥ç»‘å®šçš„ç±»å‹ä¿¡æ¯ã€æ‰€å±ä½œç”¨åŸŸã€æ˜¯å¦æ˜¯å¸¸é‡ï¼Œæˆ–è€…æ‹·è´å®ƒçš„æ ‡è¯†ç¬¦ç­‰ç­‰ã€‚</p>
<p>æœ‰äº›æƒ…å†µä¸‹ï¼ŒçŸ¥é“ä¸€ä¸ªç»‘å®šæ˜¯å¦æ˜¯å¸¸é‡éå¸¸æœ‰å¸®åŠ©ï¼Œæœ€æœ‰ç”¨çš„ä¸€ç§æƒ…å½¢å°±æ˜¯å‹ç¼©ä»£ç æ—¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">scopeOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> ref1 = <span class="string">&quot;This is a constant binding&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ²¡æœ‰ä¿®æ”¹ref1ï¼Œåˆ™ref1æ˜¯å¸¸é‡</span></span><br><span class="line">  <span class="title function_">becauseNothingEverChangesTheValueOf</span>(ref1);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">scopeTwo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ref2 = <span class="string">&quot;This is *not* a constant binding&quot;</span>;</span><br><span class="line">    ref2 = <span class="string">&quot;Because this changes the value&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="äºŒã€API"><a href="#äºŒã€API" class="headerlink" title="äºŒã€API"></a>äºŒã€<code>API</code></h2><p><code>Babel</code>æ˜¯ä¸€ç»„æ¨¡å—çš„é›†åˆï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€äº›ä¸»è¦æ¨¡å—çš„åŠŸèƒ½ä¸ä½¿ç”¨ã€‚</p>
<h3 id="1-babylon"><a href="#1-babylon" class="headerlink" title="1. babylon"></a>1. <code>babylon</code></h3><p><code>Babylon</code>æ˜¯<code>Babel</code>çš„è§£æå™¨ã€‚</p>
<ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babylon</span><br></pre></td></tr></table></figure>
<p>å…ˆæ¥è¯•ç€ä½¿ç”¨<code>Babylon</code>çš„<code>parse()</code>æ–¹æ³•ï¼Œæ¥è§£æä¸€ä¸ªç®€å•çš„ä»£ç å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babylon <span class="keyword">from</span> <span class="string">&quot;babylon&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`function square(n) &#123;</span></span><br><span class="line"><span class="string">  return n * n;</span></span><br><span class="line"><span class="string">&#125;`</span>;</span><br><span class="line"></span><br><span class="line">babylon.<span class="title function_">parse</span>(code);</span><br><span class="line"><span class="comment">// å°†ä¼šè¢«è§£æä¸ºå¦‚ä¸‹å½¢å¼çš„ast</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Node &#123;</span></span><br><span class="line"><span class="comment">//   type: &quot;File&quot;,</span></span><br><span class="line"><span class="comment">//   start: 0,</span></span><br><span class="line"><span class="comment">//   end: 38,</span></span><br><span class="line"><span class="comment">//   loc: SourceLocation &#123;...&#125;,</span></span><br><span class="line"><span class="comment">//   program: Node &#123;...&#125;,</span></span><br><span class="line"><span class="comment">//   comments: [],</span></span><br><span class="line"><span class="comment">//   tokens: [...]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>parse()</code>æ–¹æ³•è¿˜èƒ½æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡ç¤º<code>Babylon</code>å¦‚ä½•è§£æã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">babylon.<span class="title function_">parse</span>(code, &#123;</span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>, <span class="comment">// default: &quot;script&quot;</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;jsx&quot;</span>] <span class="comment">// default: []</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>sourceType</code> å¯ä»¥æ˜¯ <code>&quot;module&quot;</code> æˆ–è€… <code>&quot;script&quot;</code>ï¼Œå®ƒè¡¨ç¤º Babylon åº”è¯¥ç”¨å“ªç§æ¨¡å¼æ¥è§£æã€‚ <code>&quot;module&quot;</code> å°†ä¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è§£æå¹¶ä¸”å…è®¸æ¨¡å—å®šä¹‰ï¼Œ<code>&quot;script&quot;</code> åˆ™ä¸ä¼šã€‚é»˜è®¤å€¼ä¸º<code>&quot;script&quot;</code>ï¼Œè¯¥æ¨¡å¼ä¸‹å¦‚æœå‘ç°<code>import</code>æˆ–è€…<code>export</code>åˆ™ä¼šæŠ¥é”™ï¼Œéœ€è¦æŒ‡å®š<code>scourceType: &quot;module&quot;</code> æ¥é¿å…è¿™äº›é”™è¯¯ã€‚</p>
<p><code>Babylon</code>ä½¿ç”¨äº†åŸºäºæ’ä»¶çš„æ¶æ„ï¼Œæœ‰ä¸€ä¸ª<code>plugins</code>æ¥æ§åˆ¶å†…éƒ¨æ’ä»¶çš„å¯ç”¨å’Œå…³é—­ã€‚å¯¹äºè¯¦ç»†çš„æ’ä»¶åˆ—è¡¨ï¼Œå¯å‚è€ƒ<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/babel/babylon/blob/master/README.md#plugins">Babylon READMEæ–‡ä»¶</a>ã€‚</p>
<h3 id="2-babel-traverse"><a href="#2-babel-traverse" class="headerlink" title="2. babel-traverse"></a>2. <code>babel-traverse</code></h3><p>è¿™ä¸ªæ¨¡å—è´Ÿè´£ç»´æŠ¤æ•´ä¸ªæ ‘çš„çŠ¶æ€ï¼Œä¸”è´Ÿè´£æ›¿æ¢ã€ç§»é™¤ã€æ·»åŠ èŠ‚ç‚¹ã€‚</p>
<ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babel-traverse</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°†å…¶å’Œ<code>Babylon</code>ä¸€èµ·ä½¿ç”¨æ¥éå†å’Œæ›´æ–°èŠ‚ç‚¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babylon <span class="keyword">from</span> <span class="string">&quot;babylon&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> traverse <span class="keyword">from</span> <span class="string">&quot;babel-traverse&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`function square(n) &#123;</span></span><br><span class="line"><span class="string">  return n * n;</span></span><br><span class="line"><span class="string">&#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ast = babylon.<span class="title function_">parse</span>(code);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†è¿™æ®µ ASTï¼Œåœ¨è¿›å…¥èŠ‚ç‚¹æ—¶å°†å…¶ä¸­æ‰€æœ‰å‘½åä¸º n çš„ Identifier é‡å‘½åä¸º x</span></span><br><span class="line"><span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">  <span class="title function_">enter</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">type</span> === <span class="string">&quot;Identifier&quot;</span> &amp;&amp;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">name</span> === <span class="string">&quot;n&quot;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="3-babel-types"><a href="#3-babel-types" class="headerlink" title="3. babel-types"></a>3. <code>babel-types</code></h3><p>è¿™æ˜¯ä¸€ä¸ªç”¨äº<code>AST</code>èŠ‚ç‚¹çš„å·¥å…·åº“ï¼ŒåŒ…å«äº†æ„é€ ã€éªŒè¯ä»¥åŠå˜æ¢<code>AST</code>èŠ‚ç‚¹çš„å·¥å…·æ–¹æ³•ã€‚</p>
<ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babel-types</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import traverse from <span class="string">&quot;babel-traverse&quot;</span>;</span><br><span class="line">import * as t from <span class="string">&quot;babel-types&quot;</span>;</span><br><span class="line"></span><br><span class="line">traverse(ast<span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">  enter(path) <span class="punctuation">&#123;</span></span><br><span class="line">    if (t.isIdentifier(path.node<span class="punctuation">,</span> <span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="string">&quot;n&quot;</span> <span class="punctuation">&#125;</span>)) <span class="punctuation">&#123;</span></span><br><span class="line">      path.node.name = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="3-1-Definitions-å®šä¹‰"><a href="#3-1-Definitions-å®šä¹‰" class="headerlink" title="3.1 Definitions å®šä¹‰"></a>3.1 <code>Definitions</code> å®šä¹‰</h4><p>æ¯ä¸€ä¸ªä½†ä¸€ç±»å‹çš„èŠ‚ç‚¹éƒ½å…·æœ‰ç›¸åº”çš„å®šä¹‰ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹åŒ…å«å“ªäº›å±æ€§ï¼Œä»€ä¹ˆæ˜¯åˆæ³•å€¼ï¼Œå¦‚ä½•æ„å»ºèŠ‚ç‚¹ã€éå†èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„åˆ«åä¿¡æ¯ç­‰ã€‚å•ä¸€ç±»å‹èŠ‚ç‚¹çš„å®šä¹‰å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineType</span>(<span class="string">&quot;BinaryExpression&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">builder</span>: [<span class="string">&quot;operator&quot;</span>, <span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>],</span><br><span class="line">  <span class="attr">fields</span>: &#123;</span><br><span class="line">    <span class="attr">operator</span>: &#123;</span><br><span class="line">      <span class="attr">validate</span>: <span class="title function_">assertValueType</span>(<span class="string">&quot;string&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">left</span>: &#123;</span><br><span class="line">      <span class="attr">validate</span>: <span class="title function_">assertNodeType</span>(<span class="string">&quot;Expression&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">right</span>: &#123;</span><br><span class="line">      <span class="attr">validate</span>: <span class="title function_">assertNodeType</span>(<span class="string">&quot;Expression&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">visitor</span>: [<span class="string">&quot;left&quot;</span>, <span class="string">&quot;right&quot;</span>],</span><br><span class="line">  <span class="attr">aliases</span>: [<span class="string">&quot;Binary&quot;</span>, <span class="string">&quot;Expression&quot;</span>]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-2-Builders-æ„å»ºå™¨"><a href="#3-2-Builders-æ„å»ºå™¨" class="headerlink" title="3.2 Builders æ„å»ºå™¨"></a>3.2 <code>Builders</code> æ„å»ºå™¨</h4><p>åœ¨ä¸Šé¢çš„<code>DefineType</code>ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>builder</code>å­—æ®µï¼š<code>builder: [&quot;operator&quot;, &quot;left&quot;, &quot;right&quot;]</code>ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹éƒ½æœ‰æ„é€ å™¨æ–¹æ³•ï¼ŒæŒ‰ç±»ä¼¼ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// builder: [&quot;operator&quot;, &quot;left&quot;, &quot;right&quot;]</span></span><br><span class="line"><span class="comment">// a * b</span></span><br><span class="line">t.<span class="title function_">binaryExpression</span>(<span class="string">&quot;*&quot;</span>, t.<span class="title function_">identifier</span>(<span class="string">&quot;a&quot;</span>), t.<span class="title function_">identifier</span>(<span class="string">&quot;b&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºçš„<code>AST</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;BinaryExpression&quot;</span>,</span><br><span class="line">  <span class="attr">operator</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="attr">left</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;a&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">right</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;b&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥åˆ™æ˜¯ï¼š<code>a * b</code>ã€‚</p>
<p>æ„å»ºå™¨è¿˜ä¼šéªŒè¯è‡ªèº«åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨é”™è¯¯ä½¿ç”¨çš„æƒ…å½¢ä¸‹æŠ›å‡ºæè¿°æ€§é”™è¯¯ã€‚éªŒè¯æ—¶ä½¿ç”¨äº†éªŒè¯å™¨æ–¹æ³•ã€‚</p>
<h4 id="3-3-Validators-éªŒè¯å™¨"><a href="#3-3-Validators-éªŒè¯å™¨" class="headerlink" title="3.3 Validators éªŒè¯å™¨"></a>3.3 <code>Validators</code> éªŒè¯å™¨</h4><p><code>BinaryExpression</code> çš„å®šä¹‰ä¸­åŒ…å«äº†èŠ‚ç‚¹çš„å­—æ®µ <code>fields</code> ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•éªŒè¯è¿™äº›å­—æ®µã€‚</p>
<p>å¯ä»¥åˆ›å»ºä¸¤ç§éªŒè¯æ–¹æ³•ï¼š</p>
<ul>
<li><code>isX</code>:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="title function_">isBinaryExpression</span>(maybeBinaryExpressionNode);</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°æ¥ç¡®ä¿èŠ‚ç‚¹åŒ…å«ç‰¹å®šçš„å±æ€§å’Œå€¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="title function_">isBinaryExpression</span>(maybeBinaryExpressionNode, &#123; <span class="attr">operator</span>: <span class="string">&quot;*&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>assertX</code>ï¼š</li>
</ul>
<p>æ–­è¨€å¼æ ¡éªŒç‰ˆæœ¬ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯è¿”å› <code>true</code> æˆ– <code>false</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t.<span class="title function_">assertBinaryExpression</span>(maybeBinaryExpressionNode);</span><br><span class="line">t.<span class="title function_">assertBinaryExpression</span>(maybeBinaryExpressionNode, &#123; <span class="attr">operator</span>: <span class="string">&quot;*&quot;</span> &#125;);</span><br><span class="line"><span class="comment">// Error: Expected type &quot;BinaryExpression&quot; with option &#123; &quot;operator&quot;: &quot;*&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-Converts-å˜æ¢å™¨"><a href="#3-4-Converts-å˜æ¢å™¨" class="headerlink" title="3.4 Converts å˜æ¢å™¨"></a>3.4 <code>Converts</code> å˜æ¢å™¨</h4><p>æ­¤å¤„ä¸åšä»‹ç»ã€‚</p>
<h3 id="4-babel-generator"><a href="#4-babel-generator" class="headerlink" title="4. babel-generator"></a>4. <code>babel-generator</code></h3><p>è¿™æ˜¯<code>Babel</code>çš„ä»£ç ç”Ÿæˆå™¨ï¼Œè´Ÿè´£è¯»å–<code>AST</code>å¹¶å°†å…¶è½¬åŒ–ä¸ºä»£ç å’Œæºç æ˜ å°„(<code>source maps</code>)ã€‚</p>
<ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babel-generator</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babylon <span class="keyword">from</span> <span class="string">&quot;babylon&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> generate <span class="keyword">from</span> <span class="string">&quot;babel-generator&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`function square(n) &#123;</span></span><br><span class="line"><span class="string">  return n * n;</span></span><br><span class="line"><span class="string">&#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ast = babylon.<span class="title function_">parse</span>(code);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶ASTï¼Œç”Ÿæˆä»£ç  code å’Œ æºç æ˜ å°„ map</span></span><br><span class="line"><span class="title function_">generate</span>(ast, &#123;&#125;, code);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   code: &quot;...&quot;,</span></span><br><span class="line"><span class="comment">//   map: &quot;...&quot;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ä¸€äº›é€‰é¡¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">generate</span>(ast, &#123;</span><br><span class="line">  <span class="attr">retainLines</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">compact</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">  <span class="attr">concise</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">quotes</span>: <span class="string">&quot;double&quot;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, code);</span><br></pre></td></tr></table></figure>
<h3 id="5-babel-template"><a href="#5-babel-template" class="headerlink" title="5. babel-template"></a>5. <code>babel-template</code></h3><p>è¿™ä¸ªæ¨¡å—èƒ½è®©æˆ‘ä»¬ç¼–å†™å­—ç¬¦ä¸²å½¢å¼ä¸”å¸¦æœ‰å ä½ç¬¦çš„ä»£ç æ¥ä»£æ›¿æ‰‹åŠ¨ç¼–ç ï¼Œåœ¨ç”Ÿæˆå¤§è§„æ¨¡<code>AST</code>çš„æ—¶å€™å°¤å…¶æœ‰ç”¨ã€‚</p>
<ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save babel-template</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> template <span class="keyword">from</span> <span class="string">&quot;babel-template&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> generate <span class="keyword">from</span> <span class="string">&quot;babel-generator&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> t <span class="keyword">from</span> <span class="string">&quot;babel-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">const</span> buildRequire = <span class="title function_">template</span>(<span class="string">`</span></span><br><span class="line"><span class="string">  var IMPORT_NAME = require(SOURCE);</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”ŸæˆAST</span></span><br><span class="line"><span class="keyword">const</span> ast = <span class="title function_">buildRequire</span>(&#123;</span><br><span class="line">  <span class="attr">IMPORT_NAME</span>: t.<span class="title function_">identifier</span>(<span class="string">&quot;myModule&quot;</span>),</span><br><span class="line">  <span class="attr">SOURCE</span>: t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;my-module&quot;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”±ASTç”Ÿæˆä»£ç </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">generate</span>(ast).<span class="property">code</span>);</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯<code>generate(ast).code</code>ä¾¿èƒ½å¾—åˆ°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myModule = <span class="built_in">require</span>(<span class="string">&quot;my-module&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰-ç¼–å†™ç¬¬ä¸€ä¸ª-Babel-æ’ä»¶"><a href="#ä¸‰-ç¼–å†™ç¬¬ä¸€ä¸ª-Babel-æ’ä»¶" class="headerlink" title="ä¸‰. ç¼–å†™ç¬¬ä¸€ä¸ª Babel æ’ä»¶"></a>ä¸‰. ç¼–å†™ç¬¬ä¸€ä¸ª <code>Babel</code> æ’ä»¶</h2><p>ç»ˆäºç†Ÿæ‚‰äº†<code>Babel</code>çš„åŸºç¡€çŸ¥è¯†äº†ï¼Œç°åœ¨å¯ä»¥æ„‰å¿«åœ°å†™æ’ä»¶äº†ã€‚</p>
<p>å…ˆä»ä¸€ä¸ªæ¥æ”¶å½“å‰<code>babel</code>å¯¹è±¡ä½œä¸ºå‚æ•°çš„<code>function</code>å¼€å§‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">babel</span>) &#123;</span><br><span class="line">  <span class="comment">// plugin contents æ’ä»¶å†…å®¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº<code>babel</code>å¯¹è±¡é‡Œå¸¸ç”¨çš„æ˜¯<code>babel.types</code>ï¼Œå› æ­¤å¯ä»¥åœ¨å‚æ•°ä¸­è§£æ„ä»¥æ–¹ä¾¿ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// plugin contents</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„<code>visitor</code>å±æ€§æ˜¯è¿™ä¸ªæ’ä»¶çš„ä¸»è¦è®¿é—®è€…ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="comment">// visitor contents</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>visitor</code>çš„æ¯ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<code>path</code>å’Œ<code>state</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">Identifier</span>(path, state) &#123;&#125;,</span><br><span class="line">      <span class="title class_">ASTNodeTypeHere</span>(path, state) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å®Œæˆä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œæ¥å±•ç¤ºä¸€ä¸‹æ’ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå‡è®¾è¦å¤„ç†çš„æºä»£ç ä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo === bar;</span><br></pre></td></tr></table></figure>
<p>å…¶<code>AST</code>å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;BinaryExpression&quot;</span>,</span><br><span class="line">  <span class="attr">operator</span>: <span class="string">&quot;===&quot;</span>,</span><br><span class="line">  <span class="attr">left</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;foo&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">right</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;bar&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰<code>BinaryExpression</code>å’Œ<code>Identifier</code>ä¸¤ç§èŠ‚ç‚¹ã€‚æˆ‘ä»¬å…ˆä»æ·»åŠ <code>BinaryExpression</code>è®¿é—®è€…æ–¹æ³•å¼€å§‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæºä»£ç <code>foo === bar;</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ ç²¾ç¡®ä¸€ç‚¹ï¼Œåªå…³æ³¨æ“ä½œç¬¦ä¸º <code>===</code> çš„<code>BinaryExpression</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">visitor</span>: &#123;</span><br><span class="line">  	<span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">operator</span> !== <span class="string">&quot;===&quot;</span>) &#123;</span><br><span class="line">      	<span class="keyword">return</span>;</span><br><span class="line">    	&#125;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">// ...</span></span><br><span class="line">  	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œç”¨æ–°çš„æ ‡è¯†ç¬¦æ¥æ›¿æ¢<code>left</code>å±æ€§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">operator</span> !== <span class="string">&quot;===&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨babel-typesæ¨¡å—æä¾›çš„æ–¹æ³•</span></span><br><span class="line">  path.<span class="property">node</span>.<span class="property">left</span> = t.<span class="title function_">identifier</span>(<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œå¦‚æœè¿è¡Œè¿™ä¸ªæ’ä»¶ï¼Œåˆ™ä¼šå°†æºä»£ç è½¬æ¢æˆ:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc === bar;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œå°±å‰©ä¸‹æ›¿æ¢å³è¾¹çš„æ ‡è¯†ç¬¦çš„å·¥ä½œäº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">operator</span> !== <span class="string">&quot;===&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  path.<span class="property">node</span>.<span class="property">left</span> = t.<span class="title function_">identifier</span>(<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">  path.<span class="property">node</span>.<span class="property">right</span> = t.<span class="title function_">identifier</span>(<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™è¿è¡Œè¿™ä¸ªæ’ä»¶ï¼Œå°±èƒ½å¾—åˆ°æœ€ç»ˆç»“æœäº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc === yy;</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ï¼Œè½»æ¾å®ç°äº†ç¬¬ä¸€ä¸ª<code>Babel</code>æ’ä»¶ï¼</p>
<h2 id="å››ã€è½¬æ¢æ“ä½œ"><a href="#å››ã€è½¬æ¢æ“ä½œ" class="headerlink" title="å››ã€è½¬æ¢æ“ä½œ"></a>å››ã€è½¬æ¢æ“ä½œ</h2><p>é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„æ’ä»¶ï¼Œåº”ç”¨åœºæ™¯å¾€å¾€æ²¡è¿™ä¹ˆç®€å•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜å¾—å­¦ä¼šæ›´å¤šçš„æ“ä½œï¼Œæ¥ä½¿æˆ‘ä»¬æ‹¥æœ‰èƒ½ç¼–å†™æ›´å¼ºå¤§çš„æ’ä»¶çš„èƒ½åŠ›ã€‚</p>
<h3 id="1-è®¿é—®"><a href="#1-è®¿é—®" class="headerlink" title="1. è®¿é—®"></a>1. è®¿é—®</h3><h4 id="1-1-è·å–å­èŠ‚ç‚¹çš„-Path"><a href="#1-1-è·å–å­èŠ‚ç‚¹çš„-Path" class="headerlink" title="1.1 è·å–å­èŠ‚ç‚¹çš„ Path"></a>1.1 è·å–å­èŠ‚ç‚¹çš„ <code>Path</code></h4><p>è¦å¾—åˆ°ä¸€ä¸ª<code>AST</code>èŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆè®¿é—®åˆ°è¯¥èŠ‚ç‚¹ï¼Œå†é€šè¿‡<code>path.node.property</code>å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BinaryExpression AST èŠ‚ç‚¹ æœ‰ä¸‰ä¸ªå±æ€§: `left`, `right`, `operator`</span></span><br><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  path.<span class="property">node</span>.<span class="property">left</span>;</span><br><span class="line">  path.<span class="property">node</span>.<span class="property">right</span>;</span><br><span class="line">  path.<span class="property">node</span>.<span class="property">operator</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦è®¿é—®åˆ°è¯¥å±æ€§å†…éƒ¨çš„<code>path</code>ï¼Œåˆ™éœ€è¦ç”¨åˆ°<code>path</code>å¯¹è±¡çš„<code>get</code>æ–¹æ³•ï¼Œä¼ é€’è¯¥å±æ€§çš„å­—ç¬¦ä¸²å½¢å¼ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  path.<span class="title function_">get</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Program</span>(path) &#123;</span><br><span class="line">  <span class="comment">// æ•°å­—ç´¢å¼•ä¹Ÿæ˜¯ç”¨ . åˆ†éš”</span></span><br><span class="line">  path.<span class="title function_">get</span>(<span class="string">&#x27;body.0&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹"><a href="#1-2-æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹" class="headerlink" title="1.2 æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹"></a>1.2 æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹</h4><p>æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹å¯ä»¥é€šè¿‡<code>path.node</code>æ¥è¿›è¡Œï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    path.<span class="property">node</span>.<span class="property">left</span> != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">    path.<span class="property">node</span>.<span class="property">left</span>.<span class="property">type</span> === <span class="string">&quot;Identifier&quot;</span> &amp;&amp;</span><br><span class="line">    path.<span class="property">node</span>.<span class="property">left</span>.<span class="property">name</span> === <span class="string">&quot;n&quot;</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨èçš„åšæ³•æ˜¯ä½¿ç”¨<code>babel-types</code>æ¨¡å—æä¾›çš„æ–¹æ³•æ¥è¿›è¡Œæ£€æŸ¥ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (t.<span class="title function_">isIdentifier</span>(path.<span class="property">node</span>.<span class="property">left</span>, &#123; <span class="attr">name</span>: <span class="string">&quot;n&quot;</span> &#125;)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-æ£€æŸ¥è·¯å¾„ç±»å‹"><a href="#1-3-æ£€æŸ¥è·¯å¾„ç±»å‹" class="headerlink" title="1.3 æ£€æŸ¥è·¯å¾„ç±»å‹"></a>1.3 æ£€æŸ¥è·¯å¾„ç±»å‹</h4><p>è·¯å¾„å…·æœ‰å’Œ<code>babel-types</code>æä¾›çš„ç›¸åŒçš„æ£€æŸ¥æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="title function_">get</span>(<span class="string">&#x27;left&#x27;</span>).<span class="title function_">isIdentifier</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;n&quot;</span> &#125;)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å°±ç›¸å½“äºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (t.<span class="title function_">isIdentifier</span>(path.<span class="property">node</span>.<span class="property">left</span>, &#123; <span class="attr">name</span>: <span class="string">&quot;n&quot;</span> &#125;)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-æ£€æŸ¥æ ‡è¯†ç¬¦-Identifier-æ˜¯å¦è¢«å¼•ç”¨"><a href="#1-4-æ£€æŸ¥æ ‡è¯†ç¬¦-Identifier-æ˜¯å¦è¢«å¼•ç”¨" class="headerlink" title="1.4 æ£€æŸ¥æ ‡è¯†ç¬¦(Identifier)æ˜¯å¦è¢«å¼•ç”¨"></a>1.4 æ£€æŸ¥æ ‡è¯†ç¬¦(<code>Identifier</code>)æ˜¯å¦è¢«å¼•ç”¨</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="title function_">isReferencedIdentifier</span>()) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½¿ç”¨<code>babel-types</code>æä¾›çš„èƒ½åŠ›ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (t.<span class="title function_">isReferenced</span>(path.<span class="property">node</span>, path.<span class="property">parent</span>)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-5-æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„"><a href="#1-5-æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„" class="headerlink" title="1.5 æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„"></a>1.5 æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„</h4><p>æœ‰æ—¶å€™éœ€è¦å‘ä¸Šéå†<code>AST</code>ï¼Œç›´åˆ°æ»¡è¶³æŸäº›æ¡ä»¶ã€‚</p>
<ul>
<li>ä»¥ä¸‹æ–¹æ³•ï¼Œå¯¹äºæ¯ä¸€ä¸ªçˆ¶è·¯å¾„è°ƒç”¨<code>cb</code>ï¼Œå½“<code>cb</code>è¿”å›çœŸå€¼ï¼Œåˆ™å°†å…¶<code>NodePath</code>è¿”å›ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">findParent</span>(<span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">isObjectExpression</span>());</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœæ˜¯ä»å½“å‰èŠ‚ç‚¹å¼€å§‹éå†ï¼Œåˆ™ä½¿ç”¨<code>find</code>æ–¹æ³•ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">find</span>(<span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">isObjectExpression</span>());</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥æ‰¾æœ€ä¸´è¿‘çš„çˆ¶å‡½æ•°æˆ–è€…ç¨‹åºï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">getFunctionParent</span>();</span><br></pre></td></tr></table></figure>
<ul>
<li>å‘ä¸Šéå†è¯­æ³•æ ‘ï¼ŒçŸ¥é“æ‰¾åˆ°åœ¨åˆ—è¡¨ä¸­çš„çˆ¶èŠ‚ç‚¹è·¯å¾„ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">getStatementParent</span>();</span><br></pre></td></tr></table></figure>
<h4 id="1-6-æŸ¥æ‰¾åŒçº§è·¯å¾„"><a href="#1-6-æŸ¥æ‰¾åŒçº§è·¯å¾„" class="headerlink" title="1.6 æŸ¥æ‰¾åŒçº§è·¯å¾„"></a>1.6 æŸ¥æ‰¾åŒçº§è·¯å¾„</h4><p>å½“ä¸€ä¸ªè·¯å¾„æ˜¯åœ¨ä¸€ä¸ª<code>Function/Program</code>ä¸­çš„åˆ—è¡¨é‡Œé¢ï¼Œåˆ™å®ƒä¼šæœ‰åŒçº§è·¯å¾„ã€‚</p>
<ul>
<li>ä½¿ç”¨ <code>path.inList</code> å¯ä»¥åˆ¤æ–­æ˜¯å¦æœ‰åŒçº§è·¯å¾„ï¼›</li>
<li>ä½¿ç”¨ <code>path.getSibling(index)</code>æ¥è·å¾—åŒçº§è·¯å¾„;</li>
<li>ä½¿ç”¨ <code>path.key</code>è·å–è·¯å¾„åœ¨å®¹å™¨ä¸­çš„ç´¢å¼•;</li>
<li>ä½¿ç”¨ <code>path.container</code>è·å–è·¯å¾„çš„å®¹å™¨ï¼ˆåŒ…å«æ‰€æœ‰åŒçº§èŠ‚ç‚¹çš„æ•°ç»„ï¼‰;</li>
<li>ä½¿ç”¨ <code>path.listKey</code>è·å–å®¹å™¨çš„keyã€‚</li>
</ul>
<p>åœ¨<code>transform-merge-sibling-variables</code>æ’ä»¶ä¸­ä½¿ç”¨åˆ°äº†è¿™äº›<code>API</code>ã€‚</p>
<h4 id="1-7-åœæ­¢éå†"><a href="#1-7-åœæ­¢éå†" class="headerlink" title="1.7 åœæ­¢éå†"></a>1.7 åœæ­¢éå†</h4><p>å¦‚æœéœ€è¦æ’ä»¶åœ¨æŸäº›æƒ…å†µä¸‹ä¸ç»§ç»­è¿ä½œï¼Œåº”è¯¥å°½æ—©è¿”å›ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">operator</span> !== <span class="string">&#x27;**&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯åœ¨é¡¶çº§çš„<code>path</code>ä¸­è¿›è¡Œå­éå†ï¼Œåˆ™å¯ä»¥é€šè¿‡<code>path.skip</code>æˆ–è€…<code>path.stop</code>æ¥åœæ­¢éå†ã€‚</p>
<ul>
<li><code>path.skip</code>ï¼šè·³è¿‡å½“å‰è·¯å¾„çš„å­éå†ï¼›</li>
<li><code>path.stop</code>ï¼šåœæ­¢å½“å‰è·¯å¾„çš„éå†ï¼ˆåŒ…æ‹¬å­éå†ï¼‰ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">outerPath.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">  <span class="title class_">Function</span>(innerPath) &#123;</span><br><span class="line">    innerPath.<span class="title function_">skip</span>(); <span class="comment">// if checking the children is irrelevant</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">ReferencedIdentifier</span>(innerPath, state) &#123;</span><br><span class="line">    state.<span class="property">iife</span> = <span class="literal">true</span>;</span><br><span class="line">    innerPath.<span class="title function_">stop</span>(); <span class="comment">// if you want to save some state and then stop traversal, or deopt</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-å¤„ç†"><a href="#2-å¤„ç†" class="headerlink" title="2. å¤„ç†"></a>2. å¤„ç†</h3><p>åœ¨å®é™…ç¼–å†™æ’ä»¶æ—¶ï¼Œæˆ‘ä»¬å¸¸éœ€è¦è¿›è¡Œå„ç§å¢åˆ æ”¹ç­‰å¤„ç†ã€‚</p>
<h4 id="2-1-æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹"><a href="#2-1-æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="2.1 æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹"></a>2.1 æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹</h4><p>ä½¿ç”¨<code>path.replaceWith</code>æ¥æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  path.<span class="title function_">replaceWith</span>(</span><br><span class="line">    <span class="comment">// [operator, left, right]</span></span><br><span class="line">    t.<span class="title function_">binaryExpression</span>(<span class="string">&quot;**&quot;</span>, path.<span class="property">node</span>.<span class="property">left</span>, t.<span class="title function_">numberLiteral</span>(<span class="number">2</span>))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  function square(n) &#123;</span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="addition">+   return n ** 2;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•èŠ‚ç‚¹"><a href="#2-2-ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•èŠ‚ç‚¹" class="headerlink" title="2.2 ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•èŠ‚ç‚¹"></a>2.2 ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•èŠ‚ç‚¹</h4><p><code>path.replaceWithMultiple</code>æ–¹æ³•ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•ä¸ªèŠ‚ç‚¹ã€‚æ³¨æ„ï¼Œå‚æ•°æ˜¯å£°æ˜æ•°ç»„ã€‚<strong>å½“ç”¨å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢ä¸€ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œå®ƒä»¬å¿…é¡»æ˜¯ å£°æ˜</strong>ã€‚ è¿™æ˜¯å› ä¸º<code>Babel</code>åœ¨æ›´æ¢èŠ‚ç‚¹æ—¶å¹¿æ³›ä½¿ç”¨å¯å‘å¼ç®—æ³•ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åšä¸€äº›éå¸¸ç–¯ç‹‚çš„è½¬æ¢ï¼Œå¦åˆ™å°†ä¼šéå¸¸å†—é•¿ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ReturnStatement</span>(path) &#123;</span><br><span class="line">  path.<span class="title function_">replaceWithMultiple</span>([</span><br><span class="line">    <span class="comment">// å£°æ˜ï¼ˆå­—ç¬¦ä¸²å­—é¢é‡èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    t.<span class="title function_">expressionStatement</span>(t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;Is this the real life?&quot;</span>)),</span><br><span class="line">    t.<span class="title function_">expressionStatement</span>(t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;Is this just fantasy?&quot;</span>)),</span><br><span class="line">    t.<span class="title function_">expressionStatement</span>(t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;(Enjoy singing the rest of the song in your head)&quot;</span>)),</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  function square(n) &#123;</span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="addition">+   &quot;Is this the real life?&quot;;</span></span><br><span class="line"><span class="addition">+   &quot;Is this just fantasy?&quot;;</span></span><br><span class="line"><span class="addition">+   &quot;(Enjoy singing the rest of the song in your head)&quot;;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-ç”¨å­—ç¬¦ä¸²æºç æ›¿æ¢èŠ‚ç‚¹"><a href="#2-3-ç”¨å­—ç¬¦ä¸²æºç æ›¿æ¢èŠ‚ç‚¹" class="headerlink" title="2.3 ç”¨å­—ç¬¦ä¸²æºç æ›¿æ¢èŠ‚ç‚¹"></a>2.3 ç”¨å­—ç¬¦ä¸²æºç æ›¿æ¢èŠ‚ç‚¹</h4><p>ä½¿ç”¨<code>path.replaceWithSourceString</code>ï¼Œå°†ç›´æ¥ç”¨æºç å­—ç¬¦ä¸²æ¥æ›¿æ¢å½“å‰èŠ‚ç‚¹(<strong>ä¸å»ºè®®ä½¿ç”¨</strong>)ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123; </span><br><span class="line">	path.<span class="title function_">replaceWithSourceString</span>(</span><br><span class="line">    <span class="string">`function add(a, b) &#123; </span></span><br><span class="line"><span class="string">			return a + b; </span></span><br><span class="line"><span class="string">		&#125;`</span></span><br><span class="line">  ); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function square(n) &#123;</span></span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="addition">+ function add(a, b) &#123;</span></span><br><span class="line"><span class="addition">+   return a + b;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-æ’å…¥å…„å¼ŸèŠ‚ç‚¹"><a href="#2-4-æ’å…¥å…„å¼ŸèŠ‚ç‚¹" class="headerlink" title="2.4 æ’å…¥å…„å¼ŸèŠ‚ç‚¹"></a>2.4 æ’å…¥å…„å¼ŸèŠ‚ç‚¹</h4><p>ä½¿ç”¨<code>path.insertBefore</code>å’Œ<code>path.insertAfter</code>æ¥åœ¨å‰æˆ–åä¸€ä¸ªä½ç½®æ’å…¥å…„å¼ŸèŠ‚ç‚¹ã€‚å¦‚æœæ˜¯<strong>æ’å…¥å•ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨å£°æ˜ï¼Œå¦‚æœæ˜¯æ’å…¥å¤šä¸ªèŠ‚ç‚¹ï¼Œåˆ™åº”ä½¿ç”¨å£°æ˜æ•°ç»„ã€‚</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123; </span><br><span class="line">	path.<span class="title function_">insertBefore</span>(</span><br><span class="line">		t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">			t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;Because I&#x27;m easy come, easy go.&quot;</span>)</span><br><span class="line">		)</span><br><span class="line">	); </span><br><span class="line">	path.<span class="title function_">insertAfter</span>(</span><br><span class="line">		t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">			t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;A little high, little low.&quot;</span>)</span><br><span class="line">		)</span><br><span class="line">	); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ &quot;Because I&#x27;m easy come, easy go.&quot;;</span></span><br><span class="line">  function square(n) &#123;</span><br><span class="line">    return n * n;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="addition">+ &quot;A little high, little low.&quot;;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-5-æ’å…¥åˆ°å®¹å™¨ä¸­"><a href="#2-5-æ’å…¥åˆ°å®¹å™¨ä¸­" class="headerlink" title="2.5 æ’å…¥åˆ°å®¹å™¨ä¸­"></a>2.5 æ’å…¥åˆ°å®¹å™¨ä¸­</h4><p>åœ¨å®¹å™¨ä¸­æ’å…¥èŠ‚ç‚¹å’Œæ’å…¥å…„å¼ŸèŠ‚ç‚¹ç±»ä¼¼ï¼Œåªä¸è¿‡éœ€è¦æŒ‡å®š<code>listKey</code>ã€‚æ³¨æ„è¦ä½¿ç”¨å£°æ˜ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ClassMethod</span>(path) &#123; </span><br><span class="line">	path</span><br><span class="line">	.<span class="title function_">get</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">	.<span class="title function_">unshiftContainer</span>(</span><br><span class="line">		<span class="string">&#x27;body&#x27;</span>, </span><br><span class="line">		t.<span class="title function_">expressionStatement</span>(t.<span class="title function_">stringLiteral</span>(<span class="string">&#x27;before&#x27;</span>))</span><br><span class="line">	);</span><br><span class="line">	path</span><br><span class="line">	.<span class="title function_">get</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">	.<span class="title function_">pushContainer</span>(</span><br><span class="line">		<span class="string">&#x27;body&#x27;</span>, </span><br><span class="line">		t.<span class="title function_">expressionStatement</span>(t.<span class="title function_">stringLiteral</span>(<span class="string">&#x27;after&#x27;</span>))</span><br><span class="line">	); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line"><span class="addition">+   &quot;before&quot;</span></span><br><span class="line">    var a = &#x27;middle&#x27;;</span><br><span class="line"><span class="addition">+   &quot;after&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-6-åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹"><a href="#2-6-åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="2.6 åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹"></a>2.6 åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</h4><p>ä½¿ç”¨<code>path.remove</code>å³å¯è½»æ¾åˆ é™¤å½“å‰èŠ‚ç‚¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  path.<span class="title function_">remove</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function square(n) &#123;</span></span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="deletion">- &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-7-æ›¿æ¢çˆ¶èŠ‚ç‚¹"><a href="#2-7-æ›¿æ¢çˆ¶èŠ‚ç‚¹" class="headerlink" title="2.7 æ›¿æ¢çˆ¶èŠ‚ç‚¹"></a>2.7 æ›¿æ¢çˆ¶èŠ‚ç‚¹</h4><p>åªéœ€è¦è·å–åˆ°çˆ¶èŠ‚ç‚¹çš„è·¯å¾„<code>parentPath</code>ï¼Œç„¶åè°ƒç”¨<code>replaceWith</code>æ–¹æ³•å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  path.<span class="property">parentPath</span>.<span class="title function_">replaceWith</span>(</span><br><span class="line">    t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">      t.<span class="title function_">stringLiteral</span>(<span class="string">&quot;Anyway the wind blows, doesn&#x27;t really matter to me, to me.&quot;</span>))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-åˆ é™¤çˆ¶èŠ‚ç‚¹"><a href="#2-8-åˆ é™¤çˆ¶èŠ‚ç‚¹" class="headerlink" title="2.8 åˆ é™¤çˆ¶èŠ‚ç‚¹"></a>2.8 åˆ é™¤çˆ¶èŠ‚ç‚¹</h4><p>è·å–çˆ¶èŠ‚ç‚¹å¹¶æ‰§è¡Œ<code>remove</code>æ–¹æ³•å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">  path.<span class="property">parentPath</span>.<span class="title function_">remove</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  function square(n) &#123;</span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-9-å¤„ç†ä½œç”¨åŸŸ"><a href="#2-9-å¤„ç†ä½œç”¨åŸŸ" class="headerlink" title="2.9 å¤„ç†ä½œç”¨åŸŸ"></a>2.9 å¤„ç†ä½œç”¨åŸŸ</h4><ul>
<li><code>path.scope.hasBinding()</code>ï¼šæ£€æŸ¥æœ¬åœ°å˜é‡æ˜¯å¦è¢«ç»‘å®š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="property">scope</span>.<span class="title function_">hasBinding</span>(<span class="string">&quot;n&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•ä¼šéå†èŒƒå›´æ ‘æ¥æ£€æŸ¥ç‰¹å®šçš„ç»‘å®šã€‚</p>
<ul>
<li><code>path.scope.hasOwnBinding()</code>ï¼šæ£€æŸ¥ä¸€ä¸ªä½œç”¨åŸŸæ˜¯å¦æœ‰è‡ªå·±çš„ç»‘å®šã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  <span class="keyword">if</span> (path.<span class="property">scope</span>.<span class="title function_">hasOwnBinding</span>(<span class="string">&quot;n&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path.scope.generateUidIdentifierBasedOnNode</code>ï¼šåˆ›å»º<code>UID</code>ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  path.<span class="property">scope</span>.<span class="title function_">generateUidIdentifier</span>(<span class="string">&quot;uid&quot;</span>);</span><br><span class="line">  <span class="comment">// Node &#123; type: &quot;Identifier&quot;, name: &quot;_uid&quot; &#125;</span></span><br><span class="line">  path.<span class="property">scope</span>.<span class="title function_">generateUidIdentifier</span>(<span class="string">&quot;uid&quot;</span>);</span><br><span class="line">  <span class="comment">// Node &#123; type: &quot;Identifier&quot;, name: &quot;_uid2&quot; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>path.scope.parent.push</code>ï¼šæå‡å˜é‡å£°æ˜åˆ°çˆ¶çº§ä½œç”¨åŸŸã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = path.<span class="property">scope</span>.<span class="title function_">generateUidIdentifierBasedOnNode</span>(path.<span class="property">node</span>.<span class="property">id</span>);</span><br><span class="line">  path.<span class="title function_">remove</span>();</span><br><span class="line">  path.<span class="property">scope</span>.<span class="property">parent</span>.<span class="title function_">push</span>(&#123; id, <span class="attr">init</span>: path.<span class="property">node</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function square(n) &#123;</span></span><br><span class="line"><span class="addition">+ var _square = function square(n) &#123;</span></span><br><span class="line">    return n * n;</span><br><span class="line"><span class="deletion">- &#125;</span></span><br><span class="line"><span class="addition">+ &#125;;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>path.scope.rename</code>ï¼šé‡å‘½åç»‘å®šåŠå…¶å¼•ç”¨ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  path.<span class="property">scope</span>.<span class="title function_">rename</span>(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function square(n) &#123;</span></span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="addition">+ function square(x) &#123;</span></span><br><span class="line"><span class="addition">+   return x * x;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥å°†ç»‘å®šé‡å‘½åä¸ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">  path.<span class="property">scope</span>.<span class="title function_">rename</span>(<span class="string">&quot;n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function square(n) &#123;</span></span><br><span class="line"><span class="deletion">-   return n * n;</span></span><br><span class="line"><span class="addition">+ function square(_n) &#123;</span></span><br><span class="line"><span class="addition">+   return _n * _n;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="äº”ã€æ’ä»¶é€‰é¡¹"><a href="#äº”ã€æ’ä»¶é€‰é¡¹" class="headerlink" title="äº”ã€æ’ä»¶é€‰é¡¹"></a>äº”ã€æ’ä»¶é€‰é¡¹</h2><h3 id="1-æ’ä»¶é€‰é¡¹çš„ä½¿ç”¨"><a href="#1-æ’ä»¶é€‰é¡¹çš„ä½¿ç”¨" class="headerlink" title="1. æ’ä»¶é€‰é¡¹çš„ä½¿ç”¨"></a>1. æ’ä»¶é€‰é¡¹çš„ä½¿ç”¨</h3><p>æ¥æ”¶æ’ä»¶é€‰é¡¹ï¼Œå¯ä»¥å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶çš„æŸäº›è¡Œä¸ºï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    [<span class="string">&quot;my-plugin&quot;</span>, &#123;</span><br><span class="line">      <span class="string">&quot;option1&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;option2&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›é€‰é¡¹é€šè¿‡çŠ¶æ€å‚æ•°<code>state</code>æ¥ä¼ é€’ç»™è®¿é—®è€…ã€‚è¿™äº›é€‰é¡¹æ˜¯ç‰¹å®šäºæ’ä»¶çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è®¿é—®å…¶å®ƒæ’ä»¶ä¸­çš„é€‰é¡¹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">FunctionDeclaration</span>(path, state) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">opts</span>);</span><br><span class="line">        <span class="comment">// &#123; option1: true, option2: false &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-æ’ä»¶çš„å‡†å¤‡å’Œæ”¶å°¾å·¥ä½œ"><a href="#2-æ’ä»¶çš„å‡†å¤‡å’Œæ”¶å°¾å·¥ä½œ" class="headerlink" title="2. æ’ä»¶çš„å‡†å¤‡å’Œæ”¶å°¾å·¥ä½œ"></a>2. æ’ä»¶çš„å‡†å¤‡å’Œæ”¶å°¾å·¥ä½œ</h3><p>æ’ä»¶å¯ä»¥å…·æœ‰åœ¨æ’ä»¶ä¹‹å‰(<code>pre</code>)æˆ–ä¹‹å(<code>post</code>)æ‰§è¡Œçš„å‡½æ•°ï¼Œä»–ä»¬å¯ç”¨äºè®¾ç½®æˆ–æ¸…ç†/åˆ†æçš„ç›®çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">pre</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">StringLiteral</span>(path) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(path.<span class="property">node</span>.<span class="property">value</span>, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">post</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">cache</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-åœ¨æ’ä»¶ä¸­å¯ç”¨å…¶å®ƒè¯­æ³•"><a href="#3-åœ¨æ’ä»¶ä¸­å¯ç”¨å…¶å®ƒè¯­æ³•" class="headerlink" title="3. åœ¨æ’ä»¶ä¸­å¯ç”¨å…¶å®ƒè¯­æ³•"></a>3. åœ¨æ’ä»¶ä¸­å¯ç”¨å…¶å®ƒè¯­æ³•</h3><p>æ’ä»¶å¯ä»¥å¯ç”¨<code>babylon plugins</code>ï¼Œä»¥ä¾¿ä¸éœ€è¦ç”¨æˆ·æ¥å®‰è£…/å¯ç”¨ä»–ä»¬ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">inherits</span>: <span class="built_in">require</span>(<span class="string">&quot;babel-plugin-syntax-jsx&quot;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç»“åˆ<code>babel-code-frame</code>æ¥æŠ›å‡ºé”™è¯¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">&#123; types: t &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">visitor</span>: &#123;</span><br><span class="line">      <span class="title class_">StringLiteral</span>(path) &#123;</span><br><span class="line">        <span class="keyword">throw</span> path.<span class="title function_">buildCodeFrameError</span>(<span class="string">&quot;Error message here&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…­ã€‚æ„å»ºèŠ‚ç‚¹"><a href="#å…­ã€‚æ„å»ºèŠ‚ç‚¹" class="headerlink" title="å…­ã€‚æ„å»ºèŠ‚ç‚¹"></a>å…­ã€‚æ„å»ºèŠ‚ç‚¹</h2><p>åœ¨ç¼–å†™è½¬æ¢æ—¶ï¼Œå¾€å¾€éœ€è¦æ„å»ºä¸€äº›è¦æ’å…¥çš„èŠ‚ç‚¹è¿›<code>AST</code>ã€‚å¯ä»¥ä½¿ç”¨<code>babel-types</code>åŒ…ä¸­çš„<code>builder</code>æ–¹æ³•æ¥ç®€åŒ–æ“ä½œã€‚</p>
<p>æ„å»ºå™¨çš„æ–¹æ³•åç§°å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„èŠ‚ç‚¹ç±»å‹çš„åç§°ï¼Œé™¤äº†é¦–å­—æ¯å°å†™ã€‚ä¾‹å¦‚æƒ³å»ºç«‹ä¸€ä¸ª<code>Identifier</code>åˆ™å¯ä»¥ä½¿ç”¨<code>t.identifier(...)</code>ã€‚è¿™äº›æ„å»ºå™¨çš„å‚æ•°ç”±èŠ‚ç‚¹å®šä¹‰å†³å®šã€‚</p>
<p>è¿™é‡Œæ­£å¥½å†å¤ä¹ ä¸€ä¸‹èŠ‚ç‚¹å®šä¹‰çš„å½¢å¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineType</span>(<span class="string">&quot;MemberExpression&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">builder</span>: [<span class="string">&quot;object&quot;</span>, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;computed&quot;</span>],</span><br><span class="line">  <span class="attr">visitor</span>: [<span class="string">&quot;object&quot;</span>, <span class="string">&quot;property&quot;</span>],</span><br><span class="line">  <span class="attr">aliases</span>: [<span class="string">&quot;Expression&quot;</span>, <span class="string">&quot;LVal&quot;</span>],</span><br><span class="line">  <span class="attr">fields</span>: &#123;</span><br><span class="line">    <span class="attr">object</span>: &#123;</span><br><span class="line">      <span class="attr">validate</span>: <span class="title function_">assertNodeType</span>(<span class="string">&quot;Expression&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">property</span>: &#123;</span><br><span class="line">      <span class="title function_">validate</span>(<span class="params">node, key, val</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> expectedType = node.<span class="property">computed</span> ? <span class="string">&quot;Expression&quot;</span> : <span class="string">&quot;Identifier&quot;</span>;</span><br><span class="line">        <span class="title function_">assertNodeType</span>(expectedType)(node, key, val);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé™„ä¸Š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions">å…¨éƒ¨èŠ‚ç‚¹å®šä¹‰</a>ã€‚</p>
<h2 id="ä¸ƒã€æœ€ä½³å®è·µ"><a href="#ä¸ƒã€æœ€ä½³å®è·µ" class="headerlink" title="ä¸ƒã€æœ€ä½³å®è·µ"></a>ä¸ƒã€æœ€ä½³å®è·µ</h2><h3 id="1-åˆ›å»º-æ„å»ºå™¨-å’Œ-æ ¡éªŒå™¨-è¾…åŠ©å‡½æ•°"><a href="#1-åˆ›å»º-æ„å»ºå™¨-å’Œ-æ ¡éªŒå™¨-è¾…åŠ©å‡½æ•°" class="headerlink" title="1.åˆ›å»º æ„å»ºå™¨ å’Œ æ ¡éªŒå™¨ è¾…åŠ©å‡½æ•°"></a>1.åˆ›å»º æ„å»ºå™¨ å’Œ æ ¡éªŒå™¨ è¾…åŠ©å‡½æ•°</h3><p>å°†èŠ‚ç‚¹æ£€éªŒå’ŒèŠ‚ç‚¹ç±»å‹æŠ½ç¦»å‡ºæ¥ä½œä¸ºå•ç‹¬çš„å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isAssignment</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> node &amp;&amp; node.<span class="property">operator</span> === opts.<span class="property">operator</span> + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildAssignment</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> t.<span class="title function_">assignmentExpression</span>(<span class="string">&quot;=&quot;</span>, left, right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-å°½é‡é¿å…éå†-AST"><a href="#2-å°½é‡é¿å…éå†-AST" class="headerlink" title="2. å°½é‡é¿å…éå† AST"></a>2. å°½é‡é¿å…éå† <code>AST</code></h3><p>éå†<code>AST</code>æ˜¯ä¸€é¡¹æ¶ˆè€—å·¨å¤§çš„ä»»åŠ¡ï¼Œåº”å°½é‡é¿å…ä¸å¿…è¦çš„<code>AST</code>éå†ã€‚</p>
<h3 id="3-åŠæ—¶åˆå¹¶è®¿é—®è€…"><a href="#3-åŠæ—¶åˆå¹¶è®¿é—®è€…" class="headerlink" title="3. åŠæ—¶åˆå¹¶è®¿é—®è€…"></a>3. åŠæ—¶åˆå¹¶è®¿é—®è€…</h3><p>å¦å¤–ï¼Œå¦‚æœåˆå¹¶åèƒ½å­ä¸€æ¬¡éå†ä¸­å®Œæˆå¤šä¸ªè®¿é—®è€…çš„å·¥ä½œï¼Œé‚£å°±å°†è®¿é—®è€…åˆå¹¶åˆ°ä¸€èµ·ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">  <span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå¯ä»¥åˆå¹¶åˆ°ä¸€ä¸ª<code>visitor</code>ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title class_">BinaryExpression</span>(path) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-ä¼˜åŒ–åµŒå¥—çš„è®¿é—®è€…å¯¹è±¡"><a href="#4-ä¼˜åŒ–åµŒå¥—çš„è®¿é—®è€…å¯¹è±¡" class="headerlink" title="4. ä¼˜åŒ–åµŒå¥—çš„è®¿é—®è€…å¯¹è±¡"></a>4. ä¼˜åŒ–åµŒå¥—çš„è®¿é—®è€…å¯¹è±¡</h3><p>å°†è®¿é—®è€…è¿›è¡ŒåµŒå¥—å¾€å¾€æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    path.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">      <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œæ¯å½“è°ƒç”¨<code>FunctionDeclaration()</code>æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è®¿é—®è€…å¯¹è±¡ã€‚å› æ­¤ï¼Œå°†è¯¥è®¿é—®è€…ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡é‡Œè¿›è¡Œå¤ç”¨ï¼Œå¯ä»¥å‡å°‘å¼€é”€ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nestedVisitor = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    path.<span class="title function_">traverse</span>(nestedVisitor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåµŒå¥—çš„è®¿é—®è€…ä¸­éœ€è¦ä¸€äº›çŠ¶æ€:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">var</span> exampleState = path.<span class="property">node</span>.<span class="property">params</span>[<span class="number">0</span>].<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">    path.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">      <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">        <span class="comment">// éœ€è¦çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">name</span> === exampleState) &#123;</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°†çŠ¶æ€é€šè¿‡<code>traverse</code>æ–¹æ³•æ¥ä¼ é€’ï¼Œåœ¨å†…åµŒçš„<code>visitor</code>ä¸­å°±å¯ä»¥é€šè¿‡<code>this</code>æ¥è®¿é—®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nestedVisitor = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>(path) &#123;</span><br><span class="line">    <span class="comment">// åµŒå¥—çš„visitorå¯ä»¥é€šè¿‡thisæ¥è®¿é—®çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="property">node</span>.<span class="property">name</span> === <span class="variable language_">this</span>.<span class="property">exampleState</span>) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">FunctionDeclaration</span>(path) &#123;</span><br><span class="line">    <span class="keyword">var</span> exampleState = path.<span class="property">node</span>.<span class="property">params</span>[<span class="number">0</span>].<span class="property">name</span>;</span><br><span class="line">    <span class="comment">// traverseä¼ é€’çŠ¶æ€</span></span><br><span class="line">    path.<span class="title function_">traverse</span>(nestedVisitor, &#123; exampleState &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>äº‹å®ä¸Šï¼Œå¯ä»¥ä¼˜åŒ–çš„ç‚¹è¿˜æœ‰ä¸å°‘ï¼Œä¾‹å¦‚ç»“æ„åµŒå¥—ã€æ‰‹åŠ¨æŸ¥æ‰¾ä»£æ›¿éå†ç­‰ï¼Œä»¥åŠå¯¹<code>Babel</code>æ’ä»¶è¿›è¡Œå•å…ƒæµ‹è¯•ç­‰ï¼Œå°±ä¸åœ¨æ­¤å±•å¼€äº†ã€‚æŒæ¡äº†è¿™äº›çŸ¥è¯†ï¼Œæƒ³å¿…å†™å‡ºä¸€ä¸ªç¬¦åˆéœ€è¦çš„<code>Babel</code>æ’ä»¶ä¹Ÿä¸å†æ˜¯ä»€ä¹ˆéš¾äº‹ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.onlyy.vip">ChrisLeyâ„ï¸</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.onlyy.vip/articals/d92b6379/">https://blog.onlyy.vip/articals/d92b6379/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.onlyy.vip" target="_blank">OnlyyğŸ¦„</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/articals/tags/Babel/">Babel</a><a class="post-meta__tags" href="/articals/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">å‰ç«¯å·¥ç¨‹åŒ–</a></div><div class="post_share"><div class="social-share" data-image="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æ‰“èµ</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://assets.onlyy.vip/qrcodes/WeChat.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://assets.onlyy.vip/qrcodes/WeChat.png" alt="å¾® ä¿¡"/></a><div class="post-qr-code-desc">å¾® ä¿¡</div></li><li class="reward-item"><a href="https://assets.onlyy.vip/qrcodes/Alipay.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://assets.onlyy.vip/qrcodes/Alipay.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><script defer="defer" src="/"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/articals/71570a99/"><img class="prev-cover" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" onerror="onerror=null;src='https://blog.onlyy.vip/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Ade, æ­¦æ±‰</div></div></a></div><div class="next-post pull-right"><a href="/articals/23d66f99/"><img class="next-cover" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" onerror="onerror=null;src='https://blog.onlyy.vip/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/articals/b71a7a8/" title="Babelä½¿ç”¨æŒ‡å—"><img class="cover" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-16</div><div class="title">Babelä½¿ç”¨æŒ‡å—</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://assets.onlyy.vip/icons/dst/Willow.png" onerror="this.onerror=null;this.src='https://blog.onlyy.vip/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ChrisLeyâ„ï¸</div><div class="author-info__description">Record of life ğŸ·</div></div><div class="card-info-data site-data is-center"><a href="/articals/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">34</div></a><a href="/articals/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">10</div></a><a href="/articals/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/loveyy520"><i></i><span>ğŸ›´Have a look...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/loveyy520" rel="external nofollow noreferrer" target="_blank" title="Github"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github1"></use></svg></a><a class="social-icon" href="https://www.zhihu.com/people/li-shi-lin-85-69" rel="external nofollow noreferrer" target="_blank" title="çŸ¥ä¹"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shejiaotubiao-46"></use></svg></a><a class="social-icon" href="mailto:201357337@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-email"></use></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Babel%E5%AF%B9%E4%BB%A3%E7%A0%81%E5%A4%84%E7%90%86%E5%88%86%E4%B8%BA%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">1. Babelå¯¹ä»£ç å¤„ç†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">2. è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 è¯æ³•åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 è¯­æ³•åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">3. è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%9F%E6%88%90"><span class="toc-number">1.4.</span> <span class="toc-text">4. ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91-AST"><span class="toc-number">1.5.</span> <span class="toc-text">5. æŠ½è±¡è¯­æ³•æ ‘ AST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%81%8D%E5%8E%86"><span class="toc-number">1.6.</span> <span class="toc-text">6. éå†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Visitors-%E8%AE%BF%E9%97%AE%E8%80%85"><span class="toc-number">1.7.</span> <span class="toc-text">7. Visitors (è®¿é—®è€…)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Paths-%E8%B7%AF%E5%BE%84"><span class="toc-number">1.8.</span> <span class="toc-text">8. Paths è·¯å¾„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Path-in-Visitors-%E5%AD%98%E5%9C%A8%E4%BA%8E%E8%AE%BF%E9%97%AE%E8%80%85%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="toc-number">1.8.1.</span> <span class="toc-text">Path in Visitors å­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-State-%E7%8A%B6%E6%80%81"><span class="toc-number">1.9.</span> <span class="toc-text">9. State çŠ¶æ€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-Scopes-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.10.</span> <span class="toc-text">10. Scopes ä½œç”¨åŸŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bindings-%E7%BB%91%E5%AE%9A"><span class="toc-number">1.10.1.</span> <span class="toc-text">Bindings ç»‘å®š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81API"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-babylon"><span class="toc-number">2.1.</span> <span class="toc-text">1. babylon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-babel-traverse"><span class="toc-number">2.2.</span> <span class="toc-text">2. babel-traverse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-babel-types"><span class="toc-number">2.3.</span> <span class="toc-text">3. babel-types</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Definitions-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 Definitions å®šä¹‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Builders-%E6%9E%84%E5%BB%BA%E5%99%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 Builders æ„å»ºå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Validators-%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3 Validators éªŒè¯å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-Converts-%E5%8F%98%E6%8D%A2%E5%99%A8"><span class="toc-number">2.3.4.</span> <span class="toc-text">3.4 Converts å˜æ¢å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-babel-generator"><span class="toc-number">2.4.</span> <span class="toc-text">4. babel-generator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-babel-template"><span class="toc-number">2.5.</span> <span class="toc-text">5. babel-template</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AA-Babel-%E6%8F%92%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰. ç¼–å†™ç¬¬ä¸€ä¸ª Babel æ’ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%BD%AC%E6%8D%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">å››ã€è½¬æ¢æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%BF%E9%97%AE"><span class="toc-number">4.1.</span> <span class="toc-text">1. è®¿é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%8E%B7%E5%8F%96%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84-Path"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1 è·å–å­èŠ‚ç‚¹çš„ Path</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%A3%80%E6%9F%A5%E8%8A%82%E7%82%B9%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2 æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%A3%80%E6%9F%A5%E8%B7%AF%E5%BE%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.3.</span> <span class="toc-text">1.3 æ£€æŸ¥è·¯å¾„ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%A3%80%E6%9F%A5%E6%A0%87%E8%AF%86%E7%AC%A6-Identifier-%E6%98%AF%E5%90%A6%E8%A2%AB%E5%BC%95%E7%94%A8"><span class="toc-number">4.1.4.</span> <span class="toc-text">1.4 æ£€æŸ¥æ ‡è¯†ç¬¦(Identifier)æ˜¯å¦è¢«å¼•ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E6%89%BE%E5%88%B0%E7%89%B9%E5%AE%9A%E7%9A%84%E7%88%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">4.1.5.</span> <span class="toc-text">1.5 æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E6%9F%A5%E6%89%BE%E5%90%8C%E7%BA%A7%E8%B7%AF%E5%BE%84"><span class="toc-number">4.1.6.</span> <span class="toc-text">1.6 æŸ¥æ‰¾åŒçº§è·¯å¾„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-%E5%81%9C%E6%AD%A2%E9%81%8D%E5%8E%86"><span class="toc-number">4.1.7.</span> <span class="toc-text">1.7 åœæ­¢éå†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%84%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">2. å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%9B%BF%E6%8D%A2%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.1.</span> <span class="toc-text">2.1 æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E7%94%A8%E5%A4%9A%E8%8A%82%E7%82%B9%E6%9D%A5%E6%9B%BF%E6%8D%A2%E5%8D%95%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.2 ç”¨å¤šèŠ‚ç‚¹æ¥æ›¿æ¢å•èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BA%90%E7%A0%81%E6%9B%BF%E6%8D%A2%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.3.</span> <span class="toc-text">2.3 ç”¨å­—ç¬¦ä¸²æºç æ›¿æ¢èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%8F%92%E5%85%A5%E5%85%84%E5%BC%9F%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.4.</span> <span class="toc-text">2.4 æ’å…¥å…„å¼ŸèŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E6%8F%92%E5%85%A5%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD"><span class="toc-number">4.2.5.</span> <span class="toc-text">2.5 æ’å…¥åˆ°å®¹å™¨ä¸­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.6.</span> <span class="toc-text">2.6 åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-%E6%9B%BF%E6%8D%A2%E7%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.7.</span> <span class="toc-text">2.7 æ›¿æ¢çˆ¶èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-%E5%88%A0%E9%99%A4%E7%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">4.2.8.</span> <span class="toc-text">2.8 åˆ é™¤çˆ¶èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-9-%E5%A4%84%E7%90%86%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">4.2.9.</span> <span class="toc-text">2.9 å¤„ç†ä½œç”¨åŸŸ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%8F%92%E4%BB%B6%E9%80%89%E9%A1%B9"><span class="toc-number">5.</span> <span class="toc-text">äº”ã€æ’ä»¶é€‰é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8F%92%E4%BB%B6%E9%80%89%E9%A1%B9%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">1. æ’ä»¶é€‰é¡¹çš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8F%92%E4%BB%B6%E7%9A%84%E5%87%86%E5%A4%87%E5%92%8C%E6%94%B6%E5%B0%BE%E5%B7%A5%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text">2. æ’ä»¶çš„å‡†å¤‡å’Œæ”¶å°¾å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8%E6%8F%92%E4%BB%B6%E4%B8%AD%E5%90%AF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AF%AD%E6%B3%95"><span class="toc-number">5.3.</span> <span class="toc-text">3. åœ¨æ’ä»¶ä¸­å¯ç”¨å…¶å®ƒè¯­æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%82%E6%9E%84%E5%BB%BA%E8%8A%82%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">å…­ã€‚æ„å»ºèŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">7.</span> <span class="toc-text">ä¸ƒã€æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA-%E6%9E%84%E5%BB%BA%E5%99%A8-%E5%92%8C-%E6%A0%A1%E9%AA%8C%E5%99%A8-%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">1.åˆ›å»º æ„å»ºå™¨ å’Œ æ ¡éªŒå™¨ è¾…åŠ©å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E9%81%8D%E5%8E%86-AST"><span class="toc-number">7.2.</span> <span class="toc-text">2. å°½é‡é¿å…éå† AST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%8A%E6%97%B6%E5%90%88%E5%B9%B6%E8%AE%BF%E9%97%AE%E8%80%85"><span class="toc-number">7.3.</span> <span class="toc-text">3. åŠæ—¶åˆå¹¶è®¿é—®è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BC%98%E5%8C%96%E5%B5%8C%E5%A5%97%E7%9A%84%E8%AE%BF%E9%97%AE%E8%80%85%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.4.</span> <span class="toc-text">4. ä¼˜åŒ–åµŒå¥—çš„è®¿é—®è€…å¯¹è±¡</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/articals/23d66f99/" title="Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨"><img src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" onerror="this.onerror=null;this.src='https://blog.onlyy.vip/img/404.jpg'" alt="Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨"/></a><div class="content"><a class="title" href="/articals/23d66f99/" title="Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨">Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨</a><time datetime="2022-11-30T16:56:00.000Z" title="å‘è¡¨äº 2022-12-01 00:56:00">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articals/d92b6379/" title="å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶"><img src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" onerror="this.onerror=null;this.src='https://blog.onlyy.vip/img/404.jpg'" alt="å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶"/></a><div class="content"><a class="title" href="/articals/d92b6379/" title="å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶">å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶</a><time datetime="2022-11-26T16:52:00.000Z" title="å‘è¡¨äº 2022-11-27 00:52:00">2022-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articals/71570a99/" title="Ade, æ­¦æ±‰"><img src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" onerror="this.onerror=null;this.src='https://blog.onlyy.vip/img/404.jpg'" alt="Ade, æ­¦æ±‰"/></a><div class="content"><a class="title" href="/articals/71570a99/" title="Ade, æ­¦æ±‰">Ade, æ­¦æ±‰</a><time datetime="2022-11-20T09:52:00.000Z" title="å‘è¡¨äº 2022-11-20 17:52:00">2022-11-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright"><span>&copy;2022</span><svg style="width:1.5em; height:1.5em" aria-hidden="true"><use xlink:href="#icon-Butterfly">        </use></svg><span>ChrisLeyâ„ï¸</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="èŠå¤©"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="https://blog.onlyy.vip/js/utils.js"></script><script src="https://blog.onlyy.vip/js/main.js"></script><script src="https://blog.onlyy.vip/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://blog.onlyy.vip/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'cloudbase-baas-6gxpccf2d62b75a4',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'cloudbase-baas-6gxpccf2d62b75a4',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async src="//assets.onlyy.vip/js/onlyy-blog/iconfont.js"></script><script defer src="https://assets.onlyy.vip/js/onlyy-blog/custom.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script src="//code.tidio.co/lvkqkvgv02wsgqur2hv3fhlq5vvou9ng.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 380px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 320px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png);"> <a class="categoryBar-list-link" href="articals/categories/éšç¬”/">éšç¬”</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">æ¢¦è§‰éšç¬”</span></li><li class="categoryBar-list-item" style="background:url(https://assets.onlyy.vip/photos/dont-starve/bg_goats.png);"> <a class="categoryBar-list-link" href="articals/categories/å‰ç«¯/">å‰ç«¯</a><span class="categoryBar-list-count">32</span><span class="categoryBar-list-descr">å‰ç«¯æ‚çƒ©</span></li></ul></div></div>';
      console.log('å·²æŒ‚è½½butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = '/posts/,/about/'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b71ecf86205a4d209cd76c784d236f7b';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.2.0" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.5.1" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½², ä¸»çº¿è·¯æ‰˜ç®¡äºVercel" title=""><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('å·²æŒ‚è½½butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://assets.onlyy.vip/js/onlyy-blog/footerTimer.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/23d66f99/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-12-01</span><a class="blog-slider__title" href="articals/23d66f99/" alt="">Sassè¿›é˜¶--å†™å‡ºæ›´ä¼˜é›…çš„æ ·å¼è¡¨</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/23d66f99/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/d92b6379/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="articals/d92b6379/" alt="">å¦‚ä½•æ‰‹å†™ä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„Babelæ’ä»¶</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/d92b6379/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/b71a7a8/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-16</span><a class="blog-slider__title" href="articals/b71a7a8/" alt="">Babelä½¿ç”¨æŒ‡å—</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/b71a7a8/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/876e332/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-02</span><a class="blog-slider__title" href="articals/876e332/" alt="">Vue3æºç ç³»åˆ—ï¼ˆå…«ï¼‰ï¼šrenderä¸patch â€” äº†è§£diff</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/876e332/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/aec8236e/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-29</span><a class="blog-slider__title" href="articals/aec8236e/" alt="">Vue3æºç ç³»åˆ—ï¼ˆä¸ƒï¼‰ï¼šcreateApp â€” ä¸€åˆ‡çš„èµ·æº</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/aec8236e/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/e80db997/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-22</span><a class="blog-slider__title" href="articals/e80db997/" alt="">Vue3æºç ç³»åˆ— (å…­) KeepAlive</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/e80db997/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/9baf97c7/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-21</span><a class="blog-slider__title" href="articals/9baf97c7/" alt="">Vue3æºç ç³»åˆ— (äº”) effectå’ŒReactiveEffect ã€ track ä¸ trigger</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/9baf97c7/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/f1070434/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-21</span><a class="blog-slider__title" href="articals/f1070434/" alt="">Vue3æºç ç³»åˆ— (å››) ref</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/f1070434/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/f9a32caf/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-21</span><a class="blog-slider__title" href="articals/f9a32caf/" alt="">Vue3æºç ç³»åˆ— (ä¸‰) reactive å’Œ readonly</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/f9a32caf/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/16fef359/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_winters_feast.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-21</span><a class="blog-slider__title" href="articals/16fef359/" alt="">Vue3æºç ç³»åˆ— (äºŒ) computed</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/16fef359/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="articals/dd689204/" alt=""><img width="48" height="48" src="https://assets.onlyy.vip/photos/dont-starve/bg_wendy_victorian.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-10-20</span><a class="blog-slider__title" href="articals/dd689204/" alt="">Vue3æºç ç³»åˆ— (ä¸€) watch</a><div class="blog-slider__text">ä½œè€…è¿˜åœ¨ç¡è§‰ï¼Œå¿˜äº†å†™æ–‡ç« æè¿°~</div><a class="blog-slider__button" href="articals/dd689204/" alt="">è¯¦æƒ…   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>